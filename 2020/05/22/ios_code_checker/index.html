<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>如何通过静态分析提高iOS代码质量 - zhangferry</title><meta description="随着项目的扩大，依靠人工codereview来保证项目的质量，越来越不现实，这时就有必要借助于一种自动化的代码审查工具：程序静态分析。 程序静态分析（Program Static Analysis）是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描，验证代码是否满足规范性、安全性、可靠性、可维护性等指标的一种代码分析技术。（来自百度百科） 词法分析，语法分"><meta property="og:type" content="article"><meta property="og:title" content="如何通过静态分析提高iOS代码质量"><meta property="og:url" content="http://zhangferry.github.io/2020/05/22/ios_code_checker/"><meta property="og:site_name" content="zhangferry"><meta property="og:description" content="随着项目的扩大，依靠人工codereview来保证项目的质量，越来越不现实，这时就有必要借助于一种自动化的代码审查工具：程序静态分析。 程序静态分析（Program Static Analysis）是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描，验证代码是否满足规范性、安全性、可靠性、可维护性等指标的一种代码分析技术。（来自百度百科） 词法分析，语法分"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235171e5857002-20200524072010074.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/172350fedc7e6aa2-20200524072022825.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc122be19a-20200524072035061.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc11c4f792-20200524071349318.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecffbd58df9-20200524071402318.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235114be547093-20200524071413231.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecf28954fee-20200524071427211.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234f0bd08b57c8-20200524071439420.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc856021e-20200524071454807.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc81f9502-20200524071506685.png"><meta property="article:published_time" content="2020-05-22T03:28:09.000Z"><meta property="article:modified_time" content="2020-05-23T23:20:45.539Z"><meta property="article:author" content="zhangferry"><meta property="article:tag" content="iOS"><meta property="article:tag" content="静态分析"><meta property="article:tag" content="敏捷开发"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235171e5857002-20200524072010074.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://zhangferry.github.io/2020/05/22/ios_code_checker/"},"headline":"zhangferry","image":["https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235171e5857002-20200524072010074.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/172350fedc7e6aa2-20200524072022825.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc122be19a-20200524072035061.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc11c4f792-20200524071349318.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecffbd58df9-20200524071402318.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235114be547093-20200524071413231.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecf28954fee-20200524071427211.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234f0bd08b57c8-20200524071439420.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc856021e-20200524071454807.png","https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc81f9502-20200524071506685.png"],"datePublished":"2020-05-22T03:28:09.000Z","dateModified":"2020-05-23T23:20:45.539Z","author":{"@type":"Person","name":"zhangferry"},"description":"随着项目的扩大，依靠人工codereview来保证项目的质量，越来越不现实，这时就有必要借助于一种自动化的代码审查工具：程序静态分析。 程序静态分析（Program Static Analysis）是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描，验证代码是否满足规范性、安全性、可靠性、可维护性等指标的一种代码分析技术。（来自百度百科） 词法分析，语法分"}</script><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><!--!--><!--!--><link rel="alternate" href="/atom.xml" title="zhangferry" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo_2.svg" alt="zhangferry" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhangferry"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-22T03:28:09.000Z" title="2020-05-22T03:28:09.000Z">2020-05-22</time><span class="level-item">28 分钟 读完 (大约 4241 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">如何通过静态分析提高iOS代码质量</h1><div class="content"><p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235171e5857002-20200524072010074.png" alt=""><br>随着项目的扩大，依靠人工codereview来保证项目的质量，越来越不现实，这时就有必要借助于一种自动化的代码审查工具：<strong>程序静态分析</strong>。</p>
<p>程序静态分析（Program Static Analysis）是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描，验证代码是否满足规范性、安全性、可靠性、可维护性等指标的一种代码分析技术。（来自百度百科）</p>
<p>词法分析，语法分析等工作是由编译器进行的，所以对iOS项目为了完成静态分析，我们需要借助于编译器。对于OC语言的静态分析可以完全通过<a href="http://clang.llvm.org/">Clang</a>，对于Swift的静态分析除了Clange还需要借助于<a href="http://www.jpsim.com/uncovering-sourcekit">SourceKit</a>。</p>
<p>Swift语言对应的静态分析工具是SwiftLint，OC语言对应的静态分析工具有Infer和OCLitn。以下会是对各个静态分析工具的安装和使用做一个介绍。</p>
<h2 id="SwiftLint"><a href="#SwiftLint" class="headerlink" title="SwiftLint"></a>SwiftLint</h2><p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/172350fedc7e6aa2-20200524072022825.png" alt=""><br>对于Swift项目的静态分析可以使用<a href="https://github.com/realm/SwiftLint">SwiftLint</a>。SwiftLint 是一个用于强制检查 Swift 代码风格和规定的一个工具。它的实现是 Hook 了 Clang 和 SourceKit 从而能够使用 <a href="http://clang.llvm.org/docs/IntroductionToTheClangAST.html">AST</a> 来表示源代码文件的更多精确结果。Clange我们了解了，那SourceKit是干什么用的？</p>
<p>SourceKit包含在<a href="https://github.com/apple/swift/tree/master/tools/SourceKit">Swift</a>项目的主仓库，它是一套工具集，支持Swift的大多数源代码操作特性：源代码解析、语法突出显示、排版、自动完成、跨语言头生成等工作。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装有两种方式，任选其一：</p>
<p><strong>方式一：通过Homebrew</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install swiftlint</span><br></pre></td></tr></table></figure>

<p>这种是全局安装，各个应用都可以使用。</p>
<p><strong>方式二：通过CocoaPods</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &#39;SwiftLint&#39;, :configurations &#x3D;&gt; [&#39;Debug&#39;]</span><br></pre></td></tr></table></figure>

<p>这种方式相当于把SwiftLint作为一个三方库集成进了项目，因为它只是调试工具，所以我们应该将其指定为仅Debug环境下生效。</p>
<h3 id="集成进Xcode"><a href="#集成进Xcode" class="headerlink" title="集成进Xcode"></a>集成进Xcode</h3><p>我们需要在项目中的<code>Build Phases</code>，添加一个<code>Run Script Phase</code>。如果是通过homebrew安装的，你的脚本应该是这样的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if which swiftlint &gt;/dev/null; then</span><br><span class="line">  swiftlint</span><br><span class="line">else</span><br><span class="line">  echo "warning: SwiftLint not installed, download from https://github.com/realm/SwiftLint"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>如果是通过cocoapods安装的，你得脚本应该是这样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"$&#123;PODS_ROOT&#125;/SwiftLint/swiftlint"</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc122be19a-20200524072035061.png" alt=""></p>
<h3 id="运行SwiftLint"><a href="#运行SwiftLint" class="headerlink" title="运行SwiftLint"></a>运行SwiftLint</h3><p>键入<code>CMD + B</code>编译项目，在编译完后会运行我们刚才加入的脚本，之后我们就能看到项目中大片的警告信息。有时候build信息并不能填入项目代码中，我们可以在编译的log日志里查看。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc11c4f792-20200524071349318.png" alt=""></p>
<h3 id="定制"><a href="#定制" class="headerlink" title="定制"></a>定制</h3><p>SwiftLint规则太多了，如果我们不想执行某一规则，或者想要滤掉对Pods库的分析，我们可以对SwfitLint进行配置。</p>
<p>在项目根目录新建一个<code>.swiftlint.yml</code>文件，然后填入如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disabled_rules:</span> <span class="comment"># rule identifiers to exclude from running</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">colon</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">trailing_whitespace</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">vertical_whitespace</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">function_body_length</span></span><br><span class="line"><span class="attr">opt_in_rules:</span> <span class="comment"># some rules are only opt-in</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">empty_count</span></span><br><span class="line">  <span class="comment"># Find all the available rules by running:</span></span><br><span class="line">  <span class="comment"># swiftlint rules</span></span><br><span class="line"><span class="attr">included:</span> <span class="comment"># paths to include during linting. `--path` is ignored if present.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source</span></span><br><span class="line"><span class="attr">excluded:</span> <span class="comment"># paths to ignore during linting. Takes precedence over `included`.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Carthage</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Pods</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source/ExcludedFolder</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source/ExcludedFile.swift</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source/*/ExcludedFile.swift</span> <span class="comment"># Exclude files with a wildcard</span></span><br><span class="line"><span class="attr">analyzer_rules:</span> <span class="comment"># Rules run by `swiftlint analyze` (experimental)</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">explicit_self</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># configurable rules can be customized from this configuration file</span></span><br><span class="line"><span class="comment"># binary rules can set their severity level</span></span><br><span class="line"><span class="attr">force_cast:</span> <span class="string">warning</span> <span class="comment"># implicitly</span></span><br><span class="line"><span class="attr">force_try:</span></span><br><span class="line"><span class="attr">  severity:</span> <span class="string">warning</span> <span class="comment"># explicitly</span></span><br><span class="line"><span class="comment"># rules that have both warning and error levels, can set just the warning level</span></span><br><span class="line"><span class="comment"># implicitly</span></span><br><span class="line"><span class="attr">line_length:</span> <span class="number">110</span></span><br><span class="line"><span class="comment"># they can set both implicitly with an array</span></span><br><span class="line"><span class="attr">type_body_length:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="number">300</span> <span class="comment"># warning</span></span><br><span class="line"><span class="bullet">  -</span> <span class="number">400</span> <span class="comment"># error</span></span><br><span class="line"><span class="comment"># or they can set both explicitly</span></span><br><span class="line"><span class="attr">file_length:</span></span><br><span class="line"><span class="attr">  warning:</span> <span class="number">500</span></span><br><span class="line"><span class="attr">  error:</span> <span class="number">1200</span></span><br><span class="line"><span class="comment"># naming rules can set warnings/errors for min_length and max_length</span></span><br><span class="line"><span class="comment"># additionally they can set excluded names</span></span><br><span class="line"><span class="attr">type_name:</span></span><br><span class="line"><span class="attr">  min_length:</span> <span class="number">4</span> <span class="comment"># only warning</span></span><br><span class="line"><span class="attr">  max_length:</span> <span class="comment"># warning and error</span></span><br><span class="line"><span class="attr">    warning:</span> <span class="number">40</span></span><br><span class="line"><span class="attr">    error:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">  excluded:</span> <span class="string">iPhone</span> <span class="comment"># excluded via string</span></span><br><span class="line"><span class="attr">  allowed_symbols:</span> <span class="string">["_"]</span> <span class="comment"># these are allowed in type names</span></span><br><span class="line"><span class="attr">identifier_name:</span></span><br><span class="line"><span class="attr">  min_length:</span> <span class="comment"># only min_length</span></span><br><span class="line"><span class="attr">    error:</span> <span class="number">4</span> <span class="comment"># only error</span></span><br><span class="line"><span class="attr">  excluded:</span> <span class="comment"># excluded via string array</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">id</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">URL</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">GlobalAPIKey</span></span><br><span class="line"><span class="attr">reporter:</span> <span class="string">"xcode"</span> <span class="comment"># reporter type (xcode, json, csv, checkstyle, junit, html, emoji, sonarqube, markdown)</span></span><br></pre></td></tr></table></figure>

<p>一条rules提示如下，其对应的rules名就是<code>function_body_length</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! Function Body Length Violation: Function body should span 40 lines or less excluding comments and whitespace: currently spans 43 lines (function_body_length)</span><br></pre></td></tr></table></figure>

<p><code>disabled_rules</code>下填入我们不想遵循的规则。</p>
<p><code>excluded</code>设置我们想跳过检查的目录，Carthage、Pod、SubModule这些一般可以过滤掉。</p>
<p>其他的一些像是文件长度（file_length），类型名长度（type_name），我们可以通过设置具体的数值来调节。</p>
<p>另外SwiftLint也支持自定义规则，我们可以根据自己的需求，定义自己的<code>rule</code>。</p>
<h3 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h3><p>如果我们想将此次分析生成一份报告，也是可以的（该命令是通过homebrew安装的swiftlint）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reporter type (xcode, json, csv, checkstyle, junit, html, emoji, sonarqube, markdown)</span></span><br><span class="line">$ swiftlint lint --reporter html &gt; swiftlint.html</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecffbd58df9-20200524071402318.png" alt=""></p>
<h2 id="xcodebuild"><a href="#xcodebuild" class="headerlink" title="xcodebuild"></a>xcodebuild</h2><p>xcodebuild是xcode内置的编译命令，我们可以用它来编译打包我们的iOS项目，接下来介绍的Infer和OCLint都是基于xcodebuild的编译产物进行分析的，所以有必要简单介绍一下它。</p>
<p>一般编译一个项目，我们需要指定项目名，configuration，scheme，sdk等信息以下是几个简单的命令及说明。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 不带pod的项目，target名为TargetName，在Debug下，指定模拟器sdk环境进行编译</span></span><br><span class="line">xcodebuild -target TargetName -configuration Debug -sdk iphonesimulator</span><br><span class="line"><span class="meta">#</span><span class="bash"> 带pod的项目，workspace名为TargetName.xcworkspace，在Release下，scheme为TargetName，指定真机环境进行编译。不指定模拟器环境会验证证书</span></span><br><span class="line">xcodebuild -workspace WorkspaceName.xcworkspace -scheme SchemeName Release</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清楚项目的编译产物</span></span><br><span class="line">xcodebuild -workspace WorkspaceName.xcworkspace -scheme SchemeName Release clean</span><br></pre></td></tr></table></figure>

<p><strong>之后对xcodebuild命令的使用都需要将这些参数替换为自己项目的参数。</strong></p>
<h2 id="Infer"><a href="#Infer" class="headerlink" title="Infer"></a>Infer</h2><p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235114be547093-20200524071413231.png" alt=""><br><a href="https://infer.liaohuqiu.net/">Infer</a>是Facebook开发的针对C、OC、Java语言的静态分析工具，它同时支持对iOS和Android应用的分析。对于Facebook内部的应用像是 Messenger、Instagram 和其他一些应用均是有它进行静态分析的。它主要检测隐含的问题，主要包括以下几条：</p>
<ul>
<li>资源泄露，内存泄露</li>
<li>变量和参数的非空检测</li>
<li>循环引用</li>
<li>过早的nil操作</li>
</ul>
<p>暂不支持自定义规则。</p>
<h3 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install infer</span><br></pre></td></tr></table></figure>


<p>运行infer</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> projectDir</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 跳过对Pods的分析</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> infer run --skip-analysis-in-path Pods -- xcodebuild -workspace <span class="string">"Project.xcworkspace"</span> -scheme <span class="string">"Scheme"</span> -configuration Debug -sdk iphonesimulator</span></span><br></pre></td></tr></table></figure>

<p>我们会得到一个<code>infer-out</code>的文件夹，里面是各种代码分析的文件，有txt，json等文件格式，当这样不方便查看，我们可以将其转成html格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ infer explore --html</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecf28954fee-20200524071427211.png" alt=""></p>
<p>点击trace，我们会看到该问题代码的上下文。</p>
<p>因为Infer默认是增量编译，只会分析变动的代码，如果我们想整体编译的话，需要clean一下项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcodebuild -workspace <span class="string">"Project.xcworkspace"</span> -scheme <span class="string">"Scheme"</span> -configuration Debug -sdk iphonesimulator clean</span></span><br></pre></td></tr></table></figure>

<p>再次运行Infer去编译。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ infer run --skip-analysis-in-path Pods -- xcodebuild -workspace <span class="string">"Project.xcworkspace"</span> -scheme <span class="string">"Scheme"</span> -configuration Debug -sdk iphonesimulator</span><br></pre></td></tr></table></figure>

<h3 id="Infer的大致原理"><a href="#Infer的大致原理" class="headerlink" title="Infer的大致原理"></a>Infer的大致原理</h3><p>Infer的静态分析主要分两个阶段：</p>
<p><strong>1、捕获阶段</strong></p>
<p>Infer 捕获编译命令，将文件翻译成 Infer 内部的中间语言。</p>
<p>这种翻译和编译类似，Infer 从编译过程获取信息，并进行翻译。这就是我们调用 Infer 时带上一个编译命令的原因了，比如: <code>infer -- clang -c file.c</code>, <code>infer -- javac File.java</code>。结果就是文件照常编译，同时被 Infer 翻译成中间语言，留作第二阶段处理。特别注意的就是，如果没有文件被编译，那么也没有任何文件会被分析。</p>
<p>Infer 把中间文件存储在结果文件夹中，一般来说，这个文件夹会在运行 <code>infer</code> 的目录下创建，命名是 <code>infer-out/</code>。</p>
<p><strong>2、分析阶段</strong></p>
<p>在分析阶段，Infer 分析 <code>infer-out/</code> 下的所有文件。分析时，会单独分析每个方法和函数。</p>
<p>在分析一个函数的时候，如果发现错误，将会停止分析，但这不影响其他函数的继续分析。</p>
<p>所以你在检查问题的时候，修复输出的错误之后，需要继续运行 Infer 进行检查，知道确认所有问题都已经修复。</p>
<p>错误除了会显示在标准输出之外，还会输出到文件 <code>infer-out/bug.txt</code> 中，我们过滤这些问题，仅显示最有可能存在的。</p>
<p>在结果文件夹中（<code>infer-out</code>），同时还有一个 csv 文件 <code>report.csv</code>，这里包含了所有 Infer 产生的信息，包括：错误，警告和信息。</p>
<h2 id="OCLint"><a href="#OCLint" class="headerlink" title="OCLint"></a>OCLint</h2><p><a href="http://oclint.org/">OCLint</a>是基于<a href="http://clang.llvm.org/docs/LibTooling.html">Clange Tooling</a>编写的库，它支持扩展，检测的范围比Infer要大。不光是隐藏bug，一些代码规范性的问题，例如命名和函数复杂度也均在检测范围之内。</p>
<h4 id="安装OCLint"><a href="#安装OCLint" class="headerlink" title="安装OCLint"></a>安装OCLint</h4><p>OCLint一般通过Homebrew安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap oclint/formulae   </span><br><span class="line">$ brew install oclint</span><br></pre></td></tr></table></figure>

<p>通过Hombrew安装的版本为0.13。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ oclint --version</span><br><span class="line">LLVM (http://llvm.org/):</span><br><span class="line">  LLVM version 5.0.0svn-r313528</span><br><span class="line">  Optimized build.</span><br><span class="line">  Default target: x86_64-apple-darwin19.0.0</span><br><span class="line">  Host CPU: skylake</span><br><span class="line"></span><br><span class="line">OCLint (http://oclint.org/):</span><br><span class="line">  OCLint version 0.13.</span><br><span class="line">  Built Sep 18 2017 (08:58:40).</span><br></pre></td></tr></table></figure>

<p>我分别用Xcode11在两个项目上运行过OCLint，一个实例项目可以正常运行，另一个复杂的项目却运行失败，报如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 error generated</span><br><span class="line">1 error generated</span><br><span class="line">...</span><br><span class="line">oclint: error: cannot open report output file ..../onlintReport.html</span><br></pre></td></tr></table></figure>

<p>我并不清楚原因，如果你想试试0.13能否使用的话，直接跳到安装xcpretty。如果你也遇到了这个问题，可以回来安装oclint0.15版本。</p>
<h4 id="OCLint0-15"><a href="#OCLint0-15" class="headerlink" title="OCLint0.15"></a>OCLint0.15</h4><p>我在<a href="https://github.com/oclint/oclint/issues/547">oclint issuse #547</a>这里找到了这个问题和对应的解决方案。</p>
<p>我们需要更新oclint至0.15版本。brew上的最新版本是0.13，github上的最新版本是0.15。我下载github上的release0.15版本，但是这个包并不是编译过的，不清楚是不是官方自己搞错了，只能手动编译了。因为编译要下载llvm和clange，这两个包较大，所以我将编译过后的包直接传到了这里<a href="https://github.com/zhangferry/CodeChecker">CodeChecker</a>。</p>
<p>如果不关心编译过程，可以下载编译好的包，跳到设置环境变量那一步。</p>
<p><strong>编译OCLint</strong></p>
<p>1、安装<a href="https://cmake.org/">CMake</a>和<a href="https://ninja-build.org/">Ninja</a>这两个编译工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install cmake ninja</span><br></pre></td></tr></table></figure>

<p>2、clone OCLint项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/oclint/oclint</span><br></pre></td></tr></table></figure>

<p>3、进入oclint-scripts目录，执行make命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./make</span><br></pre></td></tr></table></figure>

<p>成功之后会出现build文件夹，里面有个oclint-release就是编译成功的oclint工具。</p>
<p><strong>设置oclint工具的环境变量</strong></p>
<p>设置环境变量的目的是为了我们能够快捷访问。然后我们需要配置PATH环境变量，注意OCLint_PATH的路径为你存放oclint-release的路径。将其添加到<code>.zshrc</code>，或者<code>.bash_profile</code>文件末尾:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OCLint_PATH=/Users/zhangferry/oclint/build/oclint-release</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$OCLint_PATH</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>执行<code>source .zshrc</code>，刷新环境变量，然后验证oclint是否安装成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ oclint --version</span><br><span class="line">OCLint (http://oclint.org/):</span><br><span class="line">OCLint version 0.15.</span><br><span class="line">Built May 19 2020 (11:48:49).</span><br></pre></td></tr></table></figure>

<p>出现这个介绍就说明我们已经完成了安装。</p>
<h3 id="安装xcpretty"><a href="#安装xcpretty" class="headerlink" title="安装xcpretty"></a>安装xcpretty</h3><p>xcpretty是一个格式化xcodebuild输出内容的脚本工具，oclint的解析依赖于它的输出。它的安装方式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gem install xcpretty</span></span><br></pre></td></tr></table></figure>

<h3 id="OCLint的使用"><a href="#OCLint的使用" class="headerlink" title="OCLint的使用"></a>OCLint的使用</h3><p>在使用OCLint之前还需要一些准备工作，需要将编译项<code>COMPILER_INDEX_STORE_ENABLE</code>设置为NO。</p>
<ul>
<li>将 Project 和 Targets 中 Building Settings 下的 <code>COMPILER_INDEX_STORE_ENABLE</code> 设置为 <strong>NO</strong></li>
<li>在 podfile 中 <strong>target ‘target’ do 前面</strong>添加下面的脚本，将各个pod的编译配置也改为此选项</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">post_install <span class="keyword">do</span> <span class="params">|installer|</span></span><br><span class="line">  installer.pods_project.targets.each <span class="keyword">do</span> <span class="params">|target|</span></span><br><span class="line">      target.build_configurations.each <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">          config.build_settings[<span class="string">'COMPILER_INDEX_STORE_ENABLE'</span>] = <span class="string">"NO"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><p>1、进入项目根目录，运行如下脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcodebuild -workspace ProjectName.xcworkspace -scheme ProjectScheme -configuration Debug -sdk iphonesimulator | xcpretty -r json-compilation-database -o compile_commands.json</span></span><br></pre></td></tr></table></figure>

<p>会将xcodebuild编译过程中的一些信息记录成一个文件<code>compile_commands.json</code>，如果我们在项目根目录看到了该文件，且里面是有内容的，证明我们完成了第一步。</p>
<p>2、我们将这个json文件转成方便查看的html，过滤掉对Pods文件的分析，为了防止行数上限，我们加上行数的限制：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> oclint-json-compilation-database -e Pods -- -report-type html -o oclintReport.html -rc LONG_LINE=9999 -max-priority-1=9999 -max-priority-2=9999 -max-priority-3=9999</span></span><br></pre></td></tr></table></figure>

<p>最终会产生一个<code>oclintReport.html</code>文件。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234f0bd08b57c8-20200524071439420.png" alt=""></p>
<p>OCLint支持自定义规则，因为其本身规则已经很丰富了，自定义规则的需求应该很小，也就没有尝试。</p>
<p><strong>封装脚本</strong></p>
<p>OCLint跟Infer一样都是通过运行几个脚本语言进行执行的，我们可以将这几个命令封装成一个脚本文件，以OCLint为例，Infer也类似：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mark sure you had install the oclint and xcpretty</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> You need to replace these values with your own project configuration</span></span><br><span class="line">workspace_name="WorkSpaceName.xcworkspace"</span><br><span class="line">scheme_name="SchemeName"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove <span class="built_in">history</span></span></span><br><span class="line">rm compile_commands.json</span><br><span class="line">rm oclint_result.xml</span><br><span class="line"><span class="meta">#</span><span class="bash"> clean project</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -sdk iphonesimulator means run simulator</span></span><br><span class="line">xcodebuild -workspace $workspace_name -scheme $scheme_name -configuration Debug -sdk iphonesimulator clean || (echo "command failed"; exit 1);</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> compile_commands.json</span></span><br><span class="line">xcodebuild -workspace $workspace_name -scheme $scheme_name -configuration Debug -sdk iphonesimulator \</span><br><span class="line">| xcpretty -r json-compilation-database -o compile_commands.json \</span><br><span class="line">|| (echo "command failed"; exit 1);</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> report html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you can run `oclint -<span class="built_in">help</span>` to see all USAGE</span></span><br><span class="line">oclint-json-compilation-database -e Pods -- -report-type html -o oclintReport.html \</span><br><span class="line">-disable-rule ShortVariableName \</span><br><span class="line">-rc LONG_LINE=1000 \</span><br><span class="line">|| (echo "command failed"; exit 1);</span><br><span class="line"></span><br><span class="line">open -a "/Applications/Safari.app" oclintReport.html</span><br></pre></td></tr></table></figure>

<p><code>oclint-json-compilation-database</code>命令的几个参数说明：</p>
<p><code>-e</code><br> 需要忽略分析的文件，这些文件的警告不会出现在报告中</p>
<p><code>-rc</code><br> 需要覆盖的规则的阀值，这里可以自定义项目的阀值，<a href="]http://docs.oclint.org/en/stable/howto/thresholds.html#mccabe76">默认阀值</a></p>
<p><code>-enable-rule</code><br> 支持的规则，默认是oclint提供的都支持，可以组合-disable-rule来过滤掉一些规则<br> <a href="http://docs.oclint.org/en/stable/rules/index.html">规则列表</a></p>
<p><code>-disable-rule</code><br> 需要忽略的规则，根据项目需求设置</p>
<h4 id="在Xcode中使用OCLint"><a href="#在Xcode中使用OCLint" class="headerlink" title="在Xcode中使用OCLint"></a>在Xcode中使用OCLint</h4><p>因为OCLint提供了xcode格式的输出样式，所以我们可以将它作为一个脚本放在Xcode中。</p>
<p>1、在项目的 TARGETS 下面，点击下方的 “+” ，选择 cross-platform 下面的 Aggregate。输入名字，这里命名为 OCLint</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc856021e-20200524071454807.png" alt="new_target"></p>
<p>2、选中该Target，进入Build Phases，添加Run Script，写入下面脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Type a script or drag a script file from your workspace to insert its path.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内置变量</span></span><br><span class="line">cd $&#123;SRCROOT&#125;</span><br><span class="line">xcodebuild clean </span><br><span class="line">xcodebuild | xcpretty -r json-compilation-database</span><br><span class="line">oclint-json-compilation-database -e Pods -- -report-type xcode</span><br></pre></td></tr></table></figure>

<p>可以看出该脚本跟上面的脚本一样，只不过 将<code>oclint-json-compilation-database</code>命令的<code>-report-type</code>由<code>html</code>改为了<code>xcode</code>。而OCLint作为一个target本身就运行在特定的环境下，所以xcodebuild可以省去配置参数。</p>
<p>3、通过<code>CMD + B</code>我们编译一下项目，执行脚本任务，会得到能够定位到代码的warning信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc81f9502-20200524071506685.png" alt="xcode_warning"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以下是对这几种静态分析方案的对比，我们可以根据需求选择适合自己的静态分析方案。</p>
<table>
<thead>
<tr>
<th></th>
<th>SwiftLint</th>
<th>Infer</th>
<th>OCLint</th>
</tr>
</thead>
<tbody><tr>
<td>支持语言</td>
<td>Swift</td>
<td>C、C++、OC、Java</td>
<td>C、C++、OC</td>
</tr>
<tr>
<td>易用性</td>
<td>简单</td>
<td>较简单</td>
<td>较简单</td>
</tr>
<tr>
<td>能否集成进Xcode</td>
<td>可以</td>
<td>不能集成进xcode</td>
<td>可以</td>
</tr>
<tr>
<td>自带规则丰富度</td>
<td>较多，包含代码规范</td>
<td>相对较少，主要检测潜在问题</td>
<td>较多，包含代码规范</td>
</tr>
<tr>
<td>规则扩展性</td>
<td>可以</td>
<td>不可以</td>
<td>可以</td>
</tr>
</tbody></table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.im/post/5ce9f477f265da1b7c60f4fe#heading-1">OCLint 实现 Code Review - 给你的代码提提质量</a></p>
<p><a href="http://docs.oclint.org/en/stable/guide/xcode.html">Using OCLint in Xcode</a></p>
<p><a href="https://infer.liaohuqiu.net/docs/infer-workflow.html">Infer 的工作机制</a></p>
<p><a href="https://github.com/CYBoys/Blogs/blob/master/LLVM_Clang/LLVM%20%26%20Clang%20%E5%85%A5%E9%97%A8.md">LLVM &amp; Clang 入门</a></p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/iOS/">iOS</a><a class="link-muted mr-2" rel="tag" href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/">静态分析</a><a class="link-muted mr-2" rel="tag" href="/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/">敏捷开发</a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/images/alipay.jpeg" alt="支付宝"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/images/wechatpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/05/31/swift_advance_2/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Swift进阶黄金之路（二）</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/05/10/swift_advance_1/"><span class="level-item">Swift进阶黄金之路</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://zhangferry.github.io/2020/05/22/ios_code_checker/';
            this.page.identifier = '2020/05/22/ios_code_checker/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'https-zhangferry-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/avatar.png" alt="zhangferry"></figure><p class="title is-size-4 is-block line-height-inherit">zhangferry</p><p class="is-size-6 is-block">iOS开发</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>北京</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">64</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">31</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zhangferry" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zhangferry"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/2947186387/profile"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="https://zhangferry.com/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://colin1994.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Colin</span></span><span class="level-right"><span class="level-item tag">colin1994.github.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://www.evenvi.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Evenvi</span></span><span class="level-right"><span class="level-item tag">www.evenvi.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-24T00:11:27.000Z">2020-07-24</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/24/interview_summary_202006/">iOS面试总结（2020年6月）</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-19T09:32:57.000Z">2020-07-19</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/19/interview-multithreading/">iOS面试篇-多线程</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-30T03:28:09.000Z">2020-06-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/30/interview-network/">iOS面试篇</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-31T14:00:34.000Z">2020-05-31</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/31/swift_advance_2/">Swift进阶黄金之路（二）</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-22T03:28:09.000Z">2020-05-22</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/22/ios_code_checker/">如何通过静态分析提高iOS代码质量</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/10/"><span class="level-start"><span class="level-item">十月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">八月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/10/"><span class="level-start"><span class="level-item">十月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/09/"><span class="level-start"><span class="level-item">九月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/08/"><span class="level-start"><span class="level-item">八月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/03/"><span class="level-start"><span class="level-item">三月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ANCS/"><span class="tag">ANCS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVPlayer/"><span class="tag">AVPlayer</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cocoapods/"><span class="tag">Cocoapods</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DFU/"><span class="tag">DFU</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hybrid/"><span class="tag">Hybrid</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Notification/"><span class="tag">Notification</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UI/"><span class="tag">UI</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mac/"><span class="tag">mac</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2/"><span class="tag">博客</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E4%BD%9C/"><span class="tag">工作</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/"><span class="tag">工具</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8B%9B%E8%81%98/"><span class="tag">招聘</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/"><span class="tag">敏捷开发</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%88%E6%8A%A5/"><span class="tag">月报</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%AC%E5%9C%B0%E5%8C%96/"><span class="tag">本地化</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%9F%E6%B4%BB/"><span class="tag">生活</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/"><span class="tag">程序员</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BF%BB%E8%AF%91/"><span class="tag">翻译</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%93%9D%E7%89%99/"><span class="tag">蓝牙</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><span class="tag">计算机网络</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%98%85%E8%AF%BB/"><span class="tag">阅读</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/"><span class="tag">静态分析</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/"><span class="tag">黑苹果</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo_2.svg" alt="zhangferry" height="28"></a><p class="size-small"><span>&copy; 2020 zhangferry</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://zhangferry.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>