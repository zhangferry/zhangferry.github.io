<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>标签: Swift - zhangferry</title>


    <meta name="description" content="只有频率相同的人，才能看见彼此内心深处不为人知的优雅。">
<meta property="og:type" content="website">
<meta property="og:title" content="zhangferry">
<meta property="og:url" content="http://zhangferry.github.io/tags/Swift/index.html">
<meta property="og:site_name" content="zhangferry">
<meta property="og:description" content="只有频率相同的人，才能看见彼此内心深处不为人知的优雅。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://zhangferry.github.io/images/og_image.png">
<meta property="article:author" content="zhangferry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zhangferry.github.io/images/og_image.png">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="zhangferry" type="application/atom+xml">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo_2.svg" alt="zhangferry" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhangferry">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/tags">标签</a></li>
            <li class="is-active"><a href="#" aria-current="page">Swift</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/31/swift_advance_2/"><i class="fas fa-angle-double-right"></i>Swift进阶黄金之路（二）</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-31T14:00:34.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-05-31</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-31T14:12:16.789Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-31</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    37 分钟 读完 (大约 5524 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/31/swift_advance_2/">Swift进阶黄金之路（二）</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/1726adc6747571fc.png" alt="image-20200511230812677"></p>
<p><a href="https://zhangferry.com/2020/05/10/swift_advance_1/">Swift进阶黄金之路（一）</a></p>
<p>上期遗留一个问题：为什么 <code>rethrows</code> 一般用在参数中含有可以 <code>throws</code> 的方法的高阶函数中。</p>
<p>我们可以结合Swift的官方文档对<code>rethrows</code>再做一遍回顾：</p>
<blockquote>
<p>A function or method can be declared with the <code>rethrows</code> keyword to indicate that it throws an error only if one of its function parameters throws an error. These functions and methods are known as <em>rethrowing functions</em> and <em>rethrowing methods</em>. Rethrowing functions and methods must have at least one throwing function parameter.</p>
</blockquote>
<p>返回<code>rethrows</code>的函数要求至少有一个可抛出异常的函数式参数，而有以函数作为参数的函数就叫做高阶函数。</p>
<p>这期分两方面介绍Swift：特性修饰词和一些重要的Swift概念。</p>
<h2 id="特性修饰词"><a href="#特性修饰词" class="headerlink" title="特性修饰词"></a><strong>特性修饰词</strong></h2><p>在Swift语法中有很多<code>@</code>符号，这些<code>@</code>符号在Swift4之前的版本大多是兼容OC的特性，Swift4及之后则出现越来越多搭配<code>@</code>符号的新特性。以<code>@</code>开头的修饰词，在官网中叫<code>Attributes</code>，在SwiftGG的翻译中叫<a href="https://www.cnswift.org/attributes">特性</a>，我并没有找到这一类被<code>@</code>修饰的符号的统称，就暂且叫他们<code>特性修饰词</code>吧，如果有清楚的小伙伴可以告知我。</p>
<p>从Swift5的发布来看（<code>@dynamicCallable</code>,<code>@State</code>），之后将会有更多的特性修饰词出现，在他们出来之前，我们有必要先了解下现有的一些特性修饰词以及它们的作用。</p>
<p>参考：<a href="https://docs.swift.org/swift-book/ReferenceManual/Attributes.html">Swift Attributes</a></p>
<h3 id="available"><a href="#available" class="headerlink" title="@available"></a>@available</h3><p><code>@available</code>： 可用来标识计算属性、函数、类、协议、结构体、枚举等类型的生命周期。（依赖于特定的平台版本 或 Swift 版本）。它的后面一般跟至少两个参数，参数之间以逗号隔开。其中第一个参数是固定的，代表着平台和语言，可选值有以下这几个：</p>
<ul>
<li><code>iOS</code></li>
<li><code>iOSApplicationExtension</code></li>
<li><code>macOS</code></li>
<li><code>macOSApplicationExtension</code></li>
<li><code>watchOS</code></li>
<li><code>watchOSApplicationExtension</code></li>
<li><code>tvOS</code></li>
<li><code>tvOSApplicationExtension</code></li>
<li><code>swift</code></li>
</ul>
<p>可以使用<code>*</code>指代支持所有这些平台。</p>
<p>有一个我们常用的例子，当需要关闭<code>ScrollView</code>的自动调整<code>inset</code>功能时：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定该方法仅在iOS11及以上的系统设置</span></span><br><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">  scrollView.contentInsetAdjustmentBehavior = .never</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  automaticallyAdjustsScrollViewInsets = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一种用法是放在函数、结构体、枚举、类或者协议的前面，表示当前类型仅适用于某一平台：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">12.0</span>, *)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adjustDarkMode</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">12.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DarkModeConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">12.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DarkModeTheme</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>版本和平台的限定可以写多个：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(<span class="type">OSX</span> <span class="number">10.15</span>, iOS <span class="number">13</span>, tvOS <span class="number">13</span>, watchOS <span class="number">6</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">applying</span><span class="params">(<span class="number">_</span> difference: CollectionDifference&lt;Element&gt;)</span></span> -&gt; <span class="type">ArraySlice</span>&lt;<span class="type">Element</span>&gt;?</span><br></pre></td></tr></table></figure>

<p><strong>注意：作为条件语句的<code>available</code>前面是<code>#</code>，作为标记位时是<code>@</code></strong></p>
<p>刚才说了，available后面参数至少要有两个，后面的可选参数这些：</p>
<ul>
<li><p><code>deprecated</code>：从指定平台标记为过期，可以指定版本号</p>
</li>
<li><p><code>obsoleted=版本号</code>：从指定平台某个版本开始废弃（注意弃用的区别，<code>deprecated</code>是还可以继续使用，只不过是不推荐了，<code>obsoleted</code>是调用就会编译错误）该声明</p>
</li>
<li><p><code>message=信息内容</code>：给出一些附加信息</p>
</li>
<li><p><code>unavailable</code>：指定平台上是无效的</p>
</li>
<li><p><code>renamed=新名字</code>：重命名声明</p>
</li>
</ul>
<p>我们看几个例子，这个是Array里<code>flatMap</code>的函数说明：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(swift, deprecated: <span class="number">4.1</span>, renamed: <span class="string">"compactMap(_:)"</span>, message: <span class="string">"Please use compactMap(_:) for the case where closure returns an optional value"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;ElementOfResult&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">ElementOfResult</span>?) <span class="keyword">rethrows</span> -&gt; [<span class="type">ElementOfResult</span>]</span><br></pre></td></tr></table></figure>

<p>它的含义是针对swift语言，该方式在swift4.1版本之后标记为过期，对应该函数的新名字为<code>compactMap(_:)</code>，如果我们在4.1之上的版本使用该函数会收到编译器的警告，即<code>⚠️Please use compactMap(_:) for the case where closure returns an optional value</code>。</p>
<p>在Realm库里，有一个销毁<code>NotificationToken</code>的方法，被标记为<code>unavailable</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RLMNotificationToken</span> </span>&#123;</span><br><span class="line">    <span class="meta">@available</span>(*, unavailable, renamed: <span class="string">"invalidate()"</span>)</span><br><span class="line">    <span class="meta">@nonobjc</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">stop</span><span class="params">()</span></span> &#123; <span class="built_in">fatalError</span>() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>标记为<code>unavailable</code>就不会被编译器联想到。这个主要是为升级用户的迁移做准备，从可用<code>stop()</code>的版本升上了，会红色报错，提示该方法不可用。因为有<code>renamed</code>，编译器会推荐你用<code>invalidate()</code>，点击<code>fix</code>就直接切换了。所以这两个标记参数常一起出现。</p>
<h3 id="discardableResult"><a href="#discardableResult" class="headerlink" title="@discardableResult"></a>@discardableResult</h3><p>带返回的函数如果没有处理返回值会被编译器警告⚠️。但有时我们就是不需要返回值的，这个时候我们可以让编译器忽略警告，就是在方法名前用<code>@discardableResult</code>声明一下。可以参考Alamofire中<code>request</code>的写法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@discardableResult</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> url: URLConvertible,</span></span></span><br><span class="line"><span class="function"><span class="params">    method: HTTPMethod = .<span class="keyword">get</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    parameters: Parameters? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    encoding: ParameterEncoding = URLEncoding.<span class="keyword">default</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    headers: HTTPHeaders? = <span class="literal">nil</span>)</span></span></span><br><span class="line">    -&gt; <span class="type">DataRequest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">SessionManager</span>.<span class="keyword">default</span>.request(</span><br><span class="line">        url,</span><br><span class="line">        method: method,</span><br><span class="line">        parameters: parameters,</span><br><span class="line">        encoding: encoding,</span><br><span class="line">        headers: headers</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="inlinable"><a href="#inlinable" class="headerlink" title="@inlinable"></a>@inlinable</h3><p>这个关键词是可内联的声明，它来源于C语言中的<code>inline</code>。C中一般用于函数前，做内联函数，它的目的是防止当某一函数多次调用造成函数栈溢出的情况。因为声明为内联函数，会在编译时将该段函数调用用具体实现代替，这么做可以省去函数调用的时间。</p>
<p>内联函数常出现在系统库中，OC中的runtim中就有大量的<code>inline</code>使用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> inline id autorelease(id obj)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">ASSERT</span>(obj);</span><br><span class="line">    <span class="type">ASSERT</span>(!obj-&gt;isTaggedPointer());</span><br><span class="line">    id *dest __unused = autoreleaseFast(obj);</span><br><span class="line">    <span class="type">ASSERT</span>(!dest  ||  dest == <span class="type">EMPTY_POOL_PLACEHOLDER</span>  ||  *dest == obj);</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Swift中的<code>@inlinable</code>和C中的<code>inline</code>基本相同，它在标准库的定义中也广泛出现，可用于方法，计算属性，下标，便利构造方法或者deinit方法中。</p>
<p>例如Swift对<code>Array</code>中<code>map</code>函数的定义：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inlinable <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; [<span class="type">T</span>]</span><br></pre></td></tr></table></figure>

<p>其实Array中声明的大部分函数前面都加了<code>@inlinable</code>，当应用某一处调用该方法时，编译器会将调用处用具体实现代码替换。</p>
<p><strong>需要注意内联声明不能用于标记为<code>private</code>或者<code>fileprivate</code>的地方。</strong></p>
<p>这很好理解，对私有方法的内联是没有意义的。内联的好处是运行时更快，因为它省略了从标准库调用<code>map</code>实现的步骤。但这个快也是有代价的，因为是编译时做替换，这增加了编译的开销，会相应的延长编译时间。</p>
<p>内联更多的是用于系统库的特性，目前我了解的Swift三方库中仅有<a href="https://github.com/CocoaLumberjack/CocoaLumberjack">CocoaLumberjack</a>使用了<code>@inlinable</code>这个特性。</p>
<h3 id="warn-unqualified-access"><a href="#warn-unqualified-access" class="headerlink" title="@warn_unqualified_access"></a>@warn_unqualified_access</h3><p>通过命名我们可以推断出其大概含义：对“不合规”的访问进行警告。这是为了解决对于相同名称的函数，不同访问对象可能产生歧义的问题。</p>
<p>比如说，Swift 标准库中<code>Array</code>和<code>Sequence</code>均实现了<code>min()</code>方法，而系统库中也定义了<code>min(::)</code>，对于可能存在的二义性问题，我们可以借助于<code>@warn_unqualified_access</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Self</span>.<span class="title">Element</span> : <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">  @warn_unqualified_access</span><br><span class="line">  @inlinable <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>?</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> <span class="title">where</span> <span class="title">Self</span>.<span class="title">Element</span> : <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">  @warn_unqualified_access</span><br><span class="line">  @inlinable <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">()</span></span> -&gt; <span class="type">Self</span>.<span class="type">Element</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个特性声明会由编译器在可能存在二义性的场景中对我们发出警告。这里有一个场景可以便于理解它的含义，我们自定义一个求<code>Array</code>中最小值的函数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">minValue</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们会收到编译器的警告：<code>Use of &#39;min&#39; treated as a reference to instance method in protocol &#39;Sequence&#39;, Use &#39;self.&#39; to silence this warning</code>。它告诉我们编译器推断我们当前使用的是Sequence中的<code>min()</code>，这与我们的想法是违背的。因为有这个<code>@warn_unqualified_access</code>限定，我们能及时的发现问题，并解决问题：<code>self.min()</code>。</p>
<h3 id="objc"><a href="#objc" class="headerlink" title="@objc"></a>@objc</h3><p>把这个特性用到任何可以在 Objective-C 中表示的声明上——例如，非内嵌类，协议，非泛型枚举（原始值类型只能是整数），类和协议的属性、方法（包括 setter 和 getter ），初始化器，反初始化器，下标。 objc 特性告诉编译器，这个声明在 Objective-C 代码中是可用的。</p>
<p>用 objc 特性标记的类必须继承自一个 Objective-C 中定义的类。如果你把 objc 用到类或协议中，它会隐式地应用于该类或协议中 Objective-C 兼容的成员上。如果一个类继承自另一个带 objc 特性标记或 Objective-C 中定义的类，编译器也会隐式地给这个类添加 objc 特性。标记为 objc 特性的协议不能继承自非 objc 特性的协议。</p>
<p>@objc还有一个用处是当你想在OC的代码中暴露一个不同的名字时，可以用这个特性，它可以用于类，函数，枚举，枚举成员，协议，getter，setter等。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当在OC代码中访问enabled的getter方法时，是通过isEnabled</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleClass</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">var</span> enabled: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="meta">@objc</span>(isEnabled) <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="comment">// Return the appropriate value</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一特性还可以用于解决潜在的命名冲突问题，因为Swift有命名空间，常常不带前缀声明，而OC没有命名空间是需要带的，当在OC代码中引用Swift库，为了防止潜在的命名冲突，可以选择一个带前缀的名字供OC代码使用。</p>
<p><a href="https://github.com/danielgindi/Charts">Charts</a>作为一个在OC和Swift中都很常用的图标库，是需要较好的同时兼容两种语言的使用的，所以也可以看到里面有大量通过<code>@objc</code>标记对OC调用时的重命名代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span>(<span class="type">ChartAnimator</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Animator</span>: <span class="title">NSObject</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span>(<span class="type">ChartComponentBase</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">ComponentBase</span>: <span class="title">NSObject</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="objcMembers"><a href="#objcMembers" class="headerlink" title="@objcMembers"></a>@objcMembers</h3><p>因为Swift中定义的方法默认是不能被OC调用的，除非我们手动添加@objc标识。但如果一个类的方法属性较多，这样会很麻烦，于是有了这样一个标识符<code>@objcMembers</code>，它可以让整个类的属性方法都隐式添加<code>@objc</code>，不光如此对于类的子类、扩展、子类的扩展都也隐式的添加@objc，当然对于OC不支持的类型，仍然无法被OC调用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span>Members</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span> &#123; &#125;             <span class="comment">// implicitly @objc</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span> -&gt; (<span class="type">Int</span>, <span class="type">Int</span>)   <span class="comment">// not @objc, because tuple returns</span></span><br><span class="line">      <span class="comment">// aren't representable in Objective-C</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">baz</span><span class="params">()</span></span> &#123; &#125;   <span class="comment">// implicitly @objc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span> : <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">wibble</span><span class="params">()</span></span> &#123; &#125;   <span class="comment">// implicitly @objc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MySubClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">wobble</span><span class="params">()</span></span> &#123; &#125;   <span class="comment">// implicitly @objc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://juejin.im/post/5cb6dccde51d456e5a0728db">Swift3、4中的@objc、@objcMembers和dynamic</a></p>
<h3 id="testable"><a href="#testable" class="headerlink" title="@testable"></a>@testable</h3><p><code>@testable</code>是用于测试模块访问主target的一个关键词。</p>
<p>因为测试模块和主工程是两个不同的target，在swift中，每个target代表着不同的module，不同module之间访问代码需要public和open级别的关键词支撑。但是主工程并不是对外模块，为了测试修改访问权限是不应该的，所以有了<code>@testable</code>关键词。使用如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="meta">@testable</span> <span class="keyword">import</span> Project</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时测试模块就可以访问那些标记为internal或者public级别的类和成员了。</p>
<h3 id="frozen-和-unknown-default"><a href="#frozen-和-unknown-default" class="headerlink" title="@frozen 和@unknown default"></a>@frozen 和@unknown default</h3><p>frozen意为冻结，是为Swift5的ABI稳定准备的一个字段，意味向编译器保证之后不会做出改变。为什么需要这么做以及这么做有什么好处，他们和ABI稳定是息息相关的，内容有点多就不放这里了，之后会单独出一篇文章介绍，这里只介绍这两个字段的含义。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@frozen <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ComparisonResult</span> : <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> orderedAscending = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> orderedSame = <span class="number">0</span></span><br><span class="line">    <span class="keyword">case</span> orderedDescending = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@frozen <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">String</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AVPlayerItem</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Status</span> : <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> unknown = <span class="number">0</span></span><br><span class="line">    <span class="keyword">case</span> readyToPlay = <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> failed = <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ComparisonResult</code>这个枚举值被标记为<code>@frozen</code>即使保证之后该枚举值不会再变。注意到<code>String</code>作为结构体也被标记为<code>@frozen</code>，意为String结构体的属性及属性顺序将不再变化。其实我们常用的类型像<code>Int</code>、<code>Float</code>、<code>Array</code>、<code>Dictionary</code>、<code>Set</code>等都已被“冻结”。需要说明的是冻结仅针对<code>struct</code>和<code>enum</code>这种值类型，因为他们在编译器就确定好了内存布局。对于class类型，不存在是否冻结的概念，可以想下为什么。</p>
<p>对于没有标记为frozen的枚举<code>AVPlayerItem.Status</code>，则认为该枚举值在之后的系统版本中可能变化。</p>
<p>对于可能变化的枚举，我们在列出所有case的时候还需要加上对<code>@unknown default</code>的判断，这一步会有编译器检查：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> currentItem.status &#123;</span><br><span class="line">    <span class="keyword">case</span> .readyToPlay:</span><br><span class="line">        <span class="comment">/* code */</span></span><br><span class="line">    <span class="keyword">case</span> .failed:</span><br><span class="line">        <span class="comment">/* code */</span></span><br><span class="line">    <span class="keyword">case</span> .unknown:</span><br><span class="line">        <span class="comment">/* code */</span></span><br><span class="line">    @unknown <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"not supported"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="State、-Binding、-ObservedObject、-EnvironmentObject"><a href="#State、-Binding、-ObservedObject、-EnvironmentObject" class="headerlink" title="@State、@Binding、@ObservedObject、@EnvironmentObject"></a>@State、@Binding、@ObservedObject、@EnvironmentObject</h3><p>这几个是SwiftUI中出现的特性修饰词，因为我对SwiftUI的了解不多，这里就不做解释了。附一篇文章供大家了解。</p>
<p><a href="https://juejin.im/post/5d625c01f265da03cd0a8a58">[译]理解 SwiftUI 里的属性装饰器@State, @Binding, @ObservedObject, @EnvironmentObject</a></p>
<h2 id="几个重要关键词"><a href="#几个重要关键词" class="headerlink" title="几个重要关键词"></a><strong>几个重要关键词</strong></h2><h3 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h3><p>lazy是懒加载的关键词，当我们仅需要在使用时进行初始化操作就可以选用该关键词。举个例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> </span>&#123;</span><br><span class="line">  <span class="built_in">lazy</span> <span class="keyword">var</span> smallImage: <span class="type">UIImage</span> = <span class="keyword">self</span>.largeImage.resizedTo(<span class="type">Avatar</span>.defaultSmallSize)</span><br><span class="line">  <span class="keyword">var</span> largeImage: <span class="type">UIImage</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(largeImage: <span class="type">UIImage</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.largeImage = largeImage</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于smallImage，我们声明了lazy，如果我们不去调用它是不会走后面的图片缩放计算的。但是如果没有lazy，因为是初始化方法，它会直接计算出smallImage的值。所以lazy很好的避免的不必要的计算。</p>
<p>另一个常用lazy的地方是对于UI属性的定义：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> dayLabel: <span class="type">UILabel</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">   label.text = <span class="keyword">self</span>.todayText()</span><br><span class="line">    <span class="keyword">return</span> label</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<p>这里使用的是一个闭包，当调用该属性时，执行闭包里面的内容，返回具体的label，完成初始化。</p>
<p>使用lazy你可能会发现它只能通过var初始而不能通过let，这是由 <code>lazy</code> 的具体实现细节决定的：它在没有值的情况下以某种方式被初始化，然后在被访问时改变自己的值，这就要求该属性是可变的。</p>
<p>另外我们可以在Sequences中使用lazy，在讲解它之前我们先看一个例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">(x: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"Computing next value of \(x)"</span>)</span><br><span class="line">  <span class="keyword">return</span> x+<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = <span class="type">Array</span>(<span class="number">0</span>..&lt;<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">let</span> incArray = array.<span class="built_in">map</span>(increment)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Result:"</span>)</span><br><span class="line"><span class="built_in">print</span>(incArray[<span class="number">0</span>], incArray[<span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>在执行<code>print(&quot;Result:&quot;)</code>之前，<code>Computing next value of ...</code>会被执行1000次，但实际上我们只需要0和4这两个index对应的值。</p>
<p>上面说了序列也可以使用lazy，使用的方式是：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = <span class="type">Array</span>(<span class="number">0</span>..&lt;<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">let</span> incArray = array.<span class="built_in">lazy</span>.<span class="built_in">map</span>(increment)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Result:"</span>)</span><br><span class="line"><span class="built_in">print</span>(incArray[<span class="number">0</span>], incArray[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result:</span></span><br><span class="line"><span class="comment">// 1 5</span></span><br></pre></td></tr></table></figure>

<p>在执行<code>print(&quot;Result:&quot;)</code>之前，并不会打印任何东西，只打印了我们用到的1和5。就是说这里的lazy可以延迟到我们取值时才去计算map里的结果。</p>
<p>我们看下这个lazy的定义：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inlinable <span class="keyword">public</span> <span class="keyword">var</span> <span class="built_in">lazy</span>: <span class="type">LazySequence</span>&lt;<span class="type">Array</span>&lt;<span class="type">Element</span>&gt;&gt; &#123; <span class="keyword">get</span> &#125;</span><br></pre></td></tr></table></figure>

<p>它返回一个<code>LazySequence</code>的结构体，这个结构体里面包含了<code>Array</code>，而<code>map</code>的计算在<code>LazySequence</code>里又重新定义了一下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Returns a `LazyMapSequence` over this `Sequence`.  The elements of</span></span><br><span class="line"><span class="comment">/// the result are computed lazily, each time they are read, by</span></span><br><span class="line"><span class="comment">/// calling `transform` function on a base element.</span></span><br><span class="line">@inlinable <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(<span class="number">_</span> transform: @escaping <span class="params">(Base.Element)</span></span></span> -&gt; <span class="type">U</span>) -&gt; <span class="type">LazyMapSequence</span>&lt;<span class="type">Base</span>, <span class="type">U</span>&gt;</span><br></pre></td></tr></table></figure>

<p>这里完成了lazy序列的实现。<code>LazySequence</code>类型的lazy只能被用于map、flatMap、compactMap这样的高阶函数中。</p>
<p><strong>参考</strong>： <a href="https://swift.gg/2016/03/25/being-lazy/">“懒”点儿好</a></p>
<p><strong>纠错</strong>：参考文章中说：”这些类型（LazySequence）只能被用在 <code>map</code>，<code>flatMap</code>，<code>filter</code>这样的高阶函数中” 其实是没有filter的，因为filter是过滤函数，它需要完整遍历一遍序列才能完成过滤操作，是无法懒加载的，而且我查了<code>LazySequence</code>的定义，确实是没有<code>filter</code>函数的。</p>
<h3 id="unowned-weak"><a href="#unowned-weak" class="headerlink" title="unowned weak"></a>unowned weak</h3><p>Swift开发过程中我们会经常跟闭包打交道，而用到闭包就不可避免的遇到循环引用问题。在Swift处理循环引用可以使用<code>unowned</code>和<code>weak</code>这两个关键词。看下面两个例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span> (name: <span class="type">String</span> ) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(name) is deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bone</span> </span>&#123;</span><br><span class="line">   <span class="comment">// weak 修饰词</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> owner: <span class="type">Dog</span>?</span><br><span class="line">    <span class="keyword">init</span>(owner: <span class="type">Dog</span>?) &#123;</span><br><span class="line">        <span class="keyword">self</span>.owner = owner</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"bone is deinitialized"</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lucky: <span class="type">Dog</span>? = <span class="type">Dog</span>(name: <span class="string">"Lucky"</span>)</span><br><span class="line"><span class="keyword">var</span> bone: <span class="type">Bone</span>? = <span class="type">Bone</span>(owner: lucky!)</span><br><span class="line">lucky =  <span class="literal">nil</span></span><br><span class="line"><span class="comment">// Lucky is deinitialized</span></span><br></pre></td></tr></table></figure>

<p>这里Dog和Bone是相互引用的关系，如果没有<code>weak var owner: Dog?</code>这里的weak声明，将不会打印<code>Lucky is deinitialized</code>。还有一种解决循环应用的方式是把<code>weak</code>替换为<code>unowned</code>关键词。</p>
<ul>
<li>weak相当于oc里面的weak，弱引用，不会增加循环计数。主体对象释放时被weak修饰的属性也会被释放，所以weak修饰对象就是optional。</li>
<li>unowned相当于oc里面的<code>unsafe_unretained</code>，它不会增加引用计数，即使它的引用对象释放了，它仍然会保持对被已经释放了的对象的一个 “无效的” 引用，它不能是 Optional 值，也不会被指向 <code>nil</code>。如果此时为无效引用，再去尝试访问它就会crash。</li>
</ul>
<p>这两者还有一个更常用的地方是在闭包里面：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> someClosure: () -&gt; <span class="type">Void</span> = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 被weak修饰后self为optional，这里是判断self非空的操作                                </span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span> <span class="keyword">else</span> &#123; retrun &#125;</span><br><span class="line">    <span class="keyword">self</span>.doSomethings()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里如果是<code>unowned</code>修饰self的话，就不需要用guard做解包操作了。但是我们不能为了省略解包的操作就用<code>unowned</code>，也不能为了安全起见全部<code>weak</code>，弄清楚两者的适用场景非常重要。</p>
<p>根据苹果的建议：</p>
<blockquote>
<p>Define a capture in a closure as an unowned reference when the closure and the instance it captures will always refer to each other, and will always be deallocated at the same time.</p>
</blockquote>
<p>当闭包和它捕获的实例总是相互引用，并且总是同时释放时，即相同的生命周期，我们应该用unowned，除此之外的场景就用weak。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/1726adc72b8ad049.png" alt="img">img</p>
<p>参考：<a href="https://swifter.tips/retain-cycle/">内存管理，WEAK 和 UNOWNED</a></p>
<p><a href="https://swift.gg/2017/05/16/unowned-or-weak-lifetime-and-performance/">Unowned 还是 Weak？生命周期和性能对比</a></p>
<h3 id="KeyPath"><a href="#KeyPath" class="headerlink" title="KeyPath"></a>KeyPath</h3><p>KeyPath是键值路径，最开始是用于处理KVC和KVO问题，后来又做了更广泛的扩展。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// KVC问题，支持struct、class</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user1 = <span class="type">User</span>()</span><br><span class="line">user1.name = <span class="string">"ferry"</span></span><br><span class="line">user1.age = <span class="number">18</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//使用KVC取值</span></span><br><span class="line"><span class="keyword">let</span> path: <span class="type">KeyPath</span> = \<span class="type">User</span>.name</span><br><span class="line">user1[keyPath: path] = <span class="string">"zhang"</span></span><br><span class="line"><span class="keyword">let</span> name = user1[keyPath: path]</span><br><span class="line"><span class="built_in">print</span>(name) <span class="comment">//zhang</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// KVO的实现还是仅限于继承自NSObject的类型</span></span><br><span class="line"><span class="comment">// playItem为AVPlayerItem对象</span></span><br><span class="line">playItem.observe(\.status, changeHandler: &#123; (<span class="number">_</span>, change) <span class="keyword">in</span></span><br><span class="line">    <span class="comment">/* code */</span>    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这个KeyPath的定义是这样的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnyKeyPath</span> : <span class="title">Hashable</span>, <span class="title">_AppendKeyPath</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A partially type-erased key path, from a concrete root type to any</span></span><br><span class="line"><span class="comment">/// resulting value type.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PartialKeyPath</span>&lt;<span class="title">Root</span>&gt; : <span class="title">AnyKeyPath</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A key path from a specific root type to a specific resulting value type.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyPath</span>&lt;<span class="title">Root</span>, <span class="title">Value</span>&gt; : <span class="title">PartialKeyPath</span>&lt;<span class="title">Root</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>定义一个<code>KeyPath</code>需要指定两个类型，根类型和对应的结果类型。对应上面示例中的path：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path: <span class="type">KeyPath</span>&lt;<span class="type">User</span>, <span class="type">String</span>&gt; = \<span class="type">User</span>.name</span><br></pre></td></tr></table></figure>

<p>根类型就是User，结果类型就是String。也可以不指定，因为编译器可以从<code>\User.name</code>推断出来。那为什么叫根类型的？可以注意到KeyPath遵循一个协议<code>_AppendKeyPath</code>，它里面定义了很多<code>append</code>的方法，KeyPath是多层可以追加的，就是如果属性是自定义的Address类型，形如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> country: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> path: <span class="type">KeyPath</span>&lt;<span class="type">User</span>, <span class="type">String</span>&gt; = \<span class="type">User</span>.address.country</span><br></pre></td></tr></table></figure>

<p>这里根类型为<code>User</code>，次级类型是<code>Address</code>，结果类型是<code>String</code>。所以<code>path</code>的类型依然是<code>KeyPath</code>。</p>
<p>明白了这些我们可以用KeyPath做一些扩展：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sorted</span>&lt;T: Comparable&gt;<span class="params">(by keyPath: KeyPath&lt;Element, T&gt;)</span></span> -&gt; [<span class="type">Element</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> sorted &#123; a, b <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> a[keyPath: keyPath] &lt; b[keyPath: keyPath]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// users is Array&lt;User&gt;</span></span><br><span class="line"><span class="keyword">let</span> newUsers = users.sorted(by: \.age)</span><br></pre></td></tr></table></figure>

<p>这个自定义<code>sorted</code>函数实现了通过传入keyPath进行升序排列功能。</p>
<p>参考：<a href="https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/">The power of key paths in Swift</a></p>
<h3 id="some"><a href="#some" class="headerlink" title="some"></a>some</h3><p><code>some</code>是Swift5.1新增的特性。它的用法就是修饰在一个 protocol 前面，默认场景下 protocol 是没有具体类型信息的，但是用 <code>some</code> 修饰后，编译器会让 protocol 的实例类型对外透明。</p>
<p>可以通过一个例子理解这段话的含义，当我们尝试定义一个遵循<code>Equatable</code>协议的value时：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Protocol 'Equatable' can only be used as a generic constraint because it has Self or associated type requirements</span></span><br><span class="line"><span class="keyword">var</span> value: <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> value: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器提示我们<code>Equatable</code>只能被用来做泛型的约束，它不是一个具体的类型，这里我们需要使用一个遵循<code>Equatable</code>的具体类型（Int）进行定义。但有时我们并不想指定具体的类型，这时就可以在协议名前加上<code>some</code>，让编译器自己去推断value的类型：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value: some <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SwiftUI里some随处可见：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Hello World"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里使用<code>some</code>就是因为<code>View</code>是一个协议，而不是具体类型。</p>
<p>当我们尝试欺骗编译器，每次随机返回不同的<code>Equatable</code>类型：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value: some <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="type">Bool</span>.random() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>聪明的编译器是会发现的，并警告我们<code>Function declares an opaque return type, but the return statements in its body do not have matching underlying types</code>。</p>
<p>参考：<a href="https://onevcat.com/2019/06/swift-ui-firstlook/">SwiftUI 的一些初步探索 (一)</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/IMG_2555.jpg" alt="IMG_2555"></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/10/swift_advance_1/"><i class="fas fa-angle-double-right"></i>Swift进阶黄金之路</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-09T16:00:34.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-05-10</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-31T14:07:49.740Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-31</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    41 分钟 读完 (大约 6075 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/10/swift_advance_1/">Swift进阶黄金之路</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/image-20200511230812677.png" alt="image-20200511230812677"></p>
<p><a href="https://zhangferry.com/2020/05/31/swift_advance_2/">Swift进阶黄金之路（二）</a></p>
<p>这篇是对<a href="https://juejin.im/post/5e96f898e51d4546c27bcf81">一文鉴定是Swift的王者，还是青铜</a>文章中问题的解答。这些问题仅仅是表层概念，属于知识点，在我看来即使都很清楚也并不能代表上了王者，如果非要用段位类比的话，黄金还是合理的😄。</p>
<p>Swift是一门上手容易，但是精通较难的语言。即使下面这些内容都不清楚也不妨碍你开发业务需求，但是了解之后它能够帮助我们写出更加Swifty的代码。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/05/10/swift_advance_1/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="zhangferry">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        zhangferry
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        iOS开发
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>北京</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            61
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            4
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            31
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/zhangferry" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/zhangferry">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Weibo" href="https://weibo.com/2947186387/profile">
                
                <i class="fab fa-weibo"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="https://zhangferry.com/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://colin1994.github.io/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Colin</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">colin1994.github.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.evenvi.com/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Evenvi</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.evenvi.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/ANCS/" style="font-size: 10px;">ANCS</a> <a href="/tags/AVPlayer/" style="font-size: 11.67px;">AVPlayer</a> <a href="/tags/Cocoapods/" style="font-size: 10px;">Cocoapods</a> <a href="/tags/DFU/" style="font-size: 10px;">DFU</a> <a href="/tags/Hexo/" style="font-size: 11.67px;">Hexo</a> <a href="/tags/Hybrid/" style="font-size: 10px;">Hybrid</a> <a href="/tags/Notification/" style="font-size: 10px;">Notification</a> <a href="/tags/Swift/" style="font-size: 11.67px;">Swift</a> <a href="/tags/UI/" style="font-size: 13.33px;">UI</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 13.33px;">博客</a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 10px;">工作</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%8B%9B%E8%81%98/" style="font-size: 10px;">招聘</a> <a href="/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/" style="font-size: 10px;">敏捷开发</a> <a href="/tags/%E6%9C%88%E6%8A%A5/" style="font-size: 18.33px;">月报</a> <a href="/tags/%E6%9C%AC%E5%9C%B0%E5%8C%96/" style="font-size: 10px;">本地化</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 16.67px;">生活</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/" style="font-size: 10px;">程序员</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 10px;">翻译</a> <a href="/tags/%E8%93%9D%E7%89%99/" style="font-size: 15px;">蓝牙</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.67px;">设计模式</a> <a href="/tags/%E9%98%85%E8%AF%BB/" style="font-size: 10px;">阅读</a> <a href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/" style="font-size: 10px;">静态分析</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 11.67px;">面试</a> <a href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/" style="font-size: 10px;">黑苹果</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/05/31/swift_advance_2/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Swift进阶黄金之路（二）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-31T14:00:34.000Z">2020-05-31</time></div>
                    <a href="/2020/05/31/swift_advance_2/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Swift进阶黄金之路（二）</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/22/ios_code_checker/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="如何通过静态分析提高iOS代码质量">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-22T03:28:09.000Z">2020-05-22</time></div>
                    <a href="/2020/05/22/ios_code_checker/" class="title has-link-black-ter is-size-6 has-text-weight-normal">如何通过静态分析提高iOS代码质量</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/10/swift_advance_1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Swift进阶黄金之路">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T16:00:34.000Z">2020-05-10</time></div>
                    <a href="/2020/05/10/swift_advance_1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Swift进阶黄金之路</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/05/ios_photo_format_compare/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="iOS开发图片格式选择">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-05T14:39:34.000Z">2020-04-05</time></div>
                    <a href="/2020/04/05/ios_photo_format_compare/" class="title has-link-black-ter is-size-6 has-text-weight-normal">iOS开发图片格式选择</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/28/interview_kuaishou/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="快手iOS面经">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-28T05:11:27.000Z">2020-03-28</time></div>
                    <a href="/2020/03/28/interview_kuaishou/" class="title has-link-black-ter is-size-6 has-text-weight-normal">快手iOS面经</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/iOS/">iOS</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ANCS/">
                        <span class="tag">ANCS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AVPlayer/">
                        <span class="tag">AVPlayer</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Cocoapods/">
                        <span class="tag">Cocoapods</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DFU/">
                        <span class="tag">DFU</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hybrid/">
                        <span class="tag">Hybrid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Notification/">
                        <span class="tag">Notification</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Swift/">
                        <span class="tag">Swift</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/iOS/">
                        <span class="tag">iOS</span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2/">
                        <span class="tag">博客</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B7%A5%E4%BD%9C/">
                        <span class="tag">工作</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%8B%9B%E8%81%98/">
                        <span class="tag">招聘</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/">
                        <span class="tag">敏捷开发</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%9C%88%E6%8A%A5/">
                        <span class="tag">月报</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%9C%AC%E5%9C%B0%E5%8C%96/">
                        <span class="tag">本地化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%94%9F%E6%B4%BB/">
                        <span class="tag">生活</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/">
                        <span class="tag">程序员</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BF%BB%E8%AF%91/">
                        <span class="tag">翻译</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%93%9D%E7%89%99/">
                        <span class="tag">蓝牙</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="tag">计算机网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%98%85%E8%AF%BB/">
                        <span class="tag">阅读</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/">
                        <span class="tag">静态分析</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/">
                        <span class="tag">面试</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/">
                        <span class="tag">黑苹果</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen is-sticky">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo_2.svg" alt="zhangferry" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 zhangferry&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                共<span id="busuanzi_value_site_uv">0</span>个访客
                </span>
                <span id="busuanzi_container_site_pv">
                共<span id="busuanzi_value_site_pv">0</span>访问量
              </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://zhangferry.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>