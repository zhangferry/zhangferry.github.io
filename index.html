<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>zhangferry</title>


    <meta name="description" content="只有频率相同的人，才能看见彼此内心深处不为人知的优雅。">
<meta property="og:type" content="website">
<meta property="og:title" content="zhangferry">
<meta property="og:url" content="http://zhangferry.github.io/index.html">
<meta property="og:site_name" content="zhangferry">
<meta property="og:description" content="只有频率相同的人，才能看见彼此内心深处不为人知的优雅。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://zhangferry.github.io/images/og_image.png">
<meta property="article:author" content="zhangferry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zhangferry.github.io/images/og_image.png">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="zhangferry" type="application/atom+xml">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo_2.svg" alt="zhangferry" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhangferry">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/31/swift_advance_2/"><i class="fas fa-angle-double-right"></i>Swift进阶黄金之路（二）</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-31T14:00:34.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-05-31</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-31T14:07:20.923Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-31</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    37 分钟 读完 (大约 5491 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/31/swift_advance_2/">Swift进阶黄金之路（二）</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/1726adc6747571fc.png" alt="image-20200511230812677"></p>
<p><a href="https://zhangferry.com/2020/05/10/swift_advance_1/">Swift进阶黄金之路（一）</a></p>
<p>上期遗留一个问题：为什么 <code>rethrows</code> 一般用在参数中含有可以 <code>throws</code> 的方法的高阶函数中。</p>
<p>我们可以结合Swift的官方文档对<code>rethrows</code>再做一遍回顾：</p>
<blockquote>
<p>A function or method can be declared with the <code>rethrows</code> keyword to indicate that it throws an error only if one of its function parameters throws an error. These functions and methods are known as <em>rethrowing functions</em> and <em>rethrowing methods</em>. Rethrowing functions and methods must have at least one throwing function parameter.</p>
</blockquote>
<p>返回<code>rethrows</code>的函数要求至少有一个可抛出异常的函数式参数，而有以函数作为参数的函数就叫做高阶函数。</p>
<p>这期分两方面介绍Swift：特性修饰词和一些重要的Swift概念。</p>
<h2 id="特性修饰词"><a href="#特性修饰词" class="headerlink" title="特性修饰词"></a><strong>特性修饰词</strong></h2><p>在Swift语法中有很多<code>@</code>符号，这些<code>@</code>符号在Swift4之前的版本大多是兼容OC的特性，Swift4及之后则出现越来越多搭配<code>@</code>符号的新特性。以<code>@</code>开头的修饰词，在官网中叫<code>Attributes</code>，在SwiftGG的翻译中叫<a href="https://www.cnswift.org/attributes">特性</a>，我并没有找到这一类被<code>@</code>修饰的符号的统称，就暂且叫他们<code>特性修饰词</code>吧，如果有清楚的小伙伴可以告知我。</p>
<p>从Swift5的发布来看（<code>@dynamicCallable</code>,<code>@State</code>），之后将会有更多的特性修饰词出现，在他们出来之前，我们有必要先了解下现有的一些特性修饰词以及它们的作用。</p>
<p>参考：<a href="https://docs.swift.org/swift-book/ReferenceManual/Attributes.html">Swift Attributes</a></p>
<h3 id="available"><a href="#available" class="headerlink" title="@available"></a>@available</h3><p><code>@available</code>： 可用来标识计算属性、函数、类、协议、结构体、枚举等类型的生命周期。（依赖于特定的平台版本 或 Swift 版本）。它的后面一般跟至少两个参数，参数之间以逗号隔开。其中第一个参数是固定的，代表着平台和语言，可选值有以下这几个：</p>
<ul>
<li><code>iOS</code></li>
<li><code>iOSApplicationExtension</code></li>
<li><code>macOS</code></li>
<li><code>macOSApplicationExtension</code></li>
<li><code>watchOS</code></li>
<li><code>watchOSApplicationExtension</code></li>
<li><code>tvOS</code></li>
<li><code>tvOSApplicationExtension</code></li>
<li><code>swift</code></li>
</ul>
<p>可以使用<code>*</code>指代支持所有这些平台。</p>
<p>有一个我们常用的例子，当需要关闭<code>ScrollView</code>的自动调整<code>inset</code>功能时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 指定该方法仅在iOS11及以上的系统设置</span><br><span class="line">if #available(iOS 11.0, *) &#123;</span><br><span class="line">  scrollView.contentInsetAdjustmentBehavior &#x3D; .never</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  automaticallyAdjustsScrollViewInsets &#x3D; false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一种用法是放在函数、结构体、枚举、类或者协议的前面，表示当前类型仅适用于某一平台：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@available(iOS 12.0, *)</span><br><span class="line">func adjustDarkMode() &#123;</span><br><span class="line">  &#x2F;* code *&#x2F;</span><br><span class="line">&#125;</span><br><span class="line">@available(iOS 12.0, *)</span><br><span class="line">struct DarkModeConfig &#123;</span><br><span class="line">  &#x2F;* code *&#x2F;</span><br><span class="line">&#125;</span><br><span class="line">@available(iOS 12.0, *)</span><br><span class="line">protocol DarkModeTheme &#123;</span><br><span class="line">  &#x2F;* code *&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>版本和平台的限定可以写多个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@available(OSX 10.15, iOS 13, tvOS 13, watchOS 6, *)</span><br><span class="line">public func applying(_ difference: CollectionDifference&lt;Element&gt;) -&gt; ArraySlice&lt;Element&gt;?</span><br></pre></td></tr></table></figure>

<p><strong>注意：作为条件语句的<code>available</code>前面是<code>#</code>，作为标记位时是<code>@</code></strong></p>
<p>刚才说了，available后面参数至少要有两个，后面的可选参数这些：</p>
<ul>
<li><p><code>deprecated</code>：从指定平台标记为过期，可以指定版本号</p>
</li>
<li><p><code>obsoleted=版本号</code>：从指定平台某个版本开始废弃（注意弃用的区别，<code>deprecated</code>是还可以继续使用，只不过是不推荐了，<code>obsoleted</code>是调用就会编译错误）该声明</p>
</li>
<li><p><code>message=信息内容</code>：给出一些附加信息</p>
</li>
<li><p><code>unavailable</code>：指定平台上是无效的</p>
</li>
<li><p><code>renamed=新名字</code>：重命名声明</p>
</li>
</ul>
<p>我们看几个例子，这个是Array里<code>flatMap</code>的函数说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@available(swift, deprecated: 4.1, renamed: &quot;compactMap(_:)&quot;, message: &quot;Please use compactMap(_:) for the case where closure returns an optional value&quot;)</span><br><span class="line">public func flatMap&lt;ElementOfResult&gt;(_ transform: (Element) throws -&gt; ElementOfResult?) rethrows -&gt; [ElementOfResult]</span><br></pre></td></tr></table></figure>

<p>它的含义是针对swift语言，该方式在swift4.1版本之后标记为过期，对应该函数的新名字为<code>compactMap(_:)</code>，如果我们在4.1之上的版本使用该函数会收到编译器的警告，即<code>⚠️Please use compactMap(_:) for the case where closure returns an optional value</code>。</p>
<p>在Realm库里，有一个销毁<code>NotificationToken</code>的方法，被标记为<code>unavailable</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">extension RLMNotificationToken &#123;</span><br><span class="line">    @available(*, unavailable, renamed: &quot;invalidate()&quot;)</span><br><span class="line">    @nonobjc public func stop() &#123; fatalError() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>标记为<code>unavailable</code>就不会被编译器联想到。这个主要是为升级用户的迁移做准备，从可用<code>stop()</code>的版本升上了，会红色报错，提示该方法不可用。因为有<code>renamed</code>，编译器会推荐你用<code>invalidate()</code>，点击<code>fix</code>就直接切换了。所以这两个标记参数常一起出现。</p>
<h3 id="discardableResult"><a href="#discardableResult" class="headerlink" title="@discardableResult"></a>@discardableResult</h3><p>带返回的函数如果没有处理返回值会被编译器警告⚠️。但有时我们就是不需要返回值的，这个时候我们可以让编译器忽略警告，就是在方法名前用<code>@discardableResult</code>声明一下。可以参考Alamofire中<code>request</code>的写法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@discardableResult</span><br><span class="line">public func request(</span><br><span class="line">    _ url: URLConvertible,</span><br><span class="line">    method: HTTPMethod &#x3D; .get,</span><br><span class="line">    parameters: Parameters? &#x3D; nil,</span><br><span class="line">    encoding: ParameterEncoding &#x3D; URLEncoding.default,</span><br><span class="line">    headers: HTTPHeaders? &#x3D; nil)</span><br><span class="line">    -&gt; DataRequest</span><br><span class="line">&#123;</span><br><span class="line">    return SessionManager.default.request(</span><br><span class="line">        url,</span><br><span class="line">        method: method,</span><br><span class="line">        parameters: parameters,</span><br><span class="line">        encoding: encoding,</span><br><span class="line">        headers: headers</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="inlinable"><a href="#inlinable" class="headerlink" title="@inlinable"></a>@inlinable</h3><p>这个关键词是可内联的声明，它来源于C语言中的<code>inline</code>。C中一般用于函数前，做内联函数，它的目的是防止当某一函数多次调用造成函数栈溢出的情况。因为声明为内联函数，会在编译时将该段函数调用用具体实现代替，这么做可以省去函数调用的时间。</p>
<p>内联函数常出现在系统库中，OC中的runtim中就有大量的<code>inline</code>使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static inline id autorelease(id obj)</span><br><span class="line">&#123;</span><br><span class="line">    ASSERT(obj);</span><br><span class="line">    ASSERT(!obj-&gt;isTaggedPointer());</span><br><span class="line">    id *dest __unused &#x3D; autoreleaseFast(obj);</span><br><span class="line">    ASSERT(!dest  ||  dest &#x3D;&#x3D; EMPTY_POOL_PLACEHOLDER  ||  *dest &#x3D;&#x3D; obj);</span><br><span class="line">    return obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Swift中的<code>@inlinable</code>和C中的<code>inline</code>基本相同，它在标准库的定义中也广泛出现，可用于方法，计算属性，下标，便利构造方法或者deinit方法中。</p>
<p>例如Swift对<code>Array</code>中<code>map</code>函数的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inlinable public func map&lt;T&gt;(_ transform: (Element) throws -&gt; T) rethrows -&gt; [T]</span><br></pre></td></tr></table></figure>

<p>其实Array中声明的大部分函数前面都加了<code>@inlinable</code>，当应用某一处调用该方法时，编译器会将调用处用具体实现代码替换。</p>
<p><strong>需要注意内联声明不能用于标记为<code>private</code>或者<code>fileprivate</code>的地方。</strong></p>
<p>这很好理解，对私有方法的内联是没有意义的。内联的好处是运行时更快，因为它省略了从标准库调用<code>map</code>实现的步骤。但这个快也是有代价的，因为是编译时做替换，这增加了编译的开销，会相应的延长编译时间。</p>
<p>内联更多的是用于系统库的特性，目前我了解的Swift三方库中仅有<a href="https://github.com/CocoaLumberjack/CocoaLumberjack">CocoaLumberjack</a>使用了<code>@inlinable</code>这个特性。</p>
<h3 id="warn-unqualified-access"><a href="#warn-unqualified-access" class="headerlink" title="@warn_unqualified_access"></a>@warn_unqualified_access</h3><p>通过命名我们可以推断出其大概含义：对“不合规”的访问进行警告。这是为了解决对于相同名称的函数，不同访问对象可能产生歧义的问题。</p>
<p>比如说，Swift 标准库中<code>Array</code>和<code>Sequence</code>均实现了<code>min()</code>方法，而系统库中也定义了<code>min(::)</code>，对于可能存在的二义性问题，我们可以借助于<code>@warn_unqualified_access</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extension Array where Self.Element : Comparable &#123;</span><br><span class="line">  @warn_unqualified_access</span><br><span class="line">  @inlinable public func min() -&gt; Element?</span><br><span class="line">&#125;</span><br><span class="line">extension Sequence where Self.Element : Comparable &#123;</span><br><span class="line">  @warn_unqualified_access</span><br><span class="line">  @inlinable public func min() -&gt; Self.Element?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个特性声明会由编译器在可能存在二义性的场景中对我们发出警告。这里有一个场景可以便于理解它的含义，我们自定义一个求<code>Array</code>中最小值的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">extension Array where Element: Comparable &#123;</span><br><span class="line">    func minValue() -&gt; Element? &#123;</span><br><span class="line">        return min()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们会收到编译器的警告：<code>Use of &#39;min&#39; treated as a reference to instance method in protocol &#39;Sequence&#39;, Use &#39;self.&#39; to silence this warning</code>。它告诉我们编译器推断我们当前使用的是Sequence中的<code>min()</code>，这与我们的想法是违背的。因为有这个<code>@warn_unqualified_access</code>限定，我们能及时的发现问题，并解决问题：<code>self.min()</code>。</p>
<h3 id="objc"><a href="#objc" class="headerlink" title="@objc"></a>@objc</h3><p>把这个特性用到任何可以在 Objective-C 中表示的声明上——例如，非内嵌类，协议，非泛型枚举（原始值类型只能是整数），类和协议的属性、方法（包括 setter 和 getter ），初始化器，反初始化器，下标。 objc 特性告诉编译器，这个声明在 Objective-C 代码中是可用的。</p>
<p>用 objc 特性标记的类必须继承自一个 Objective-C 中定义的类。如果你把 objc 用到类或协议中，它会隐式地应用于该类或协议中 Objective-C 兼容的成员上。如果一个类继承自另一个带 objc 特性标记或 Objective-C 中定义的类，编译器也会隐式地给这个类添加 objc 特性。标记为 objc 特性的协议不能继承自非 objc 特性的协议。</p>
<p>@objc还有一个用处是当你想在OC的代码中暴露一个不同的名字时，可以用这个特性，它可以用于类，函数，枚举，枚举成员，协议，getter，setter等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 当在OC代码中访问enabled的getter方法时，是通过isEnabled</span><br><span class="line">class ExampleClass: NSObject &#123;</span><br><span class="line">    @objc var enabled: Bool &#123;</span><br><span class="line">        @objc(isEnabled) get &#123;</span><br><span class="line">            &#x2F;&#x2F; Return the appropriate value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一特性还可以用于解决潜在的命名冲突问题，因为Swift有命名空间，常常不带前缀声明，而OC没有命名空间是需要带的，当在OC代码中引用Swift库，为了防止潜在的命名冲突，可以选择一个带前缀的名字供OC代码使用。</p>
<p><a href="https://github.com/danielgindi/Charts">Charts</a>作为一个在OC和Swift中都很常用的图标库，是需要较好的同时兼容两种语言的使用的，所以也可以看到里面有大量通过<code>@objc</code>标记对OC调用时的重命名代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@objc(ChartAnimator)</span><br><span class="line">open class Animator: NSObject &#123; &#125;</span><br><span class="line"></span><br><span class="line">@objc(ChartComponentBase)</span><br><span class="line">open class ComponentBase: NSObject &#123; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="objcMembers"><a href="#objcMembers" class="headerlink" title="@objcMembers"></a>@objcMembers</h3><p>因为Swift中定义的方法默认是不能被OC调用的，除非我们手动添加@objc标识。但如果一个类的方法属性较多，这样会很麻烦，于是有了这样一个标识符<code>@objcMembers</code>，它可以让整个类的属性方法都隐式添加<code>@objc</code>，不光如此对于类的子类、扩展、子类的扩展都也隐式的添加@objc，当然对于OC不支持的类型，仍然无法被OC调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@objcMembers</span><br><span class="line">class MyClass : NSObject &#123;</span><br><span class="line">  func foo() &#123; &#125;             &#x2F;&#x2F; implicitly @objc</span><br><span class="line"></span><br><span class="line">  func bar() -&gt; (Int, Int)   &#x2F;&#x2F; not @objc, because tuple returns</span><br><span class="line">      &#x2F;&#x2F; aren&#39;t representable in Objective-C</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension MyClass &#123;</span><br><span class="line">  func baz() &#123; &#125;   &#x2F;&#x2F; implicitly @objc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MySubClass : MyClass &#123;</span><br><span class="line">  func wibble() &#123; &#125;   &#x2F;&#x2F; implicitly @objc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension MySubClass &#123;</span><br><span class="line">  func wobble() &#123; &#125;   &#x2F;&#x2F; implicitly @objc</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://juejin.im/post/5cb6dccde51d456e5a0728db">Swift3、4中的@objc、@objcMembers和dynamic</a></p>
<h3 id="testable"><a href="#testable" class="headerlink" title="@testable"></a>@testable</h3><p><code>@testable</code>是用于测试模块访问主target的一个关键词。</p>
<p>因为测试模块和主工程是两个不同的target，在swift中，每个target代表着不同的module，不同module之间访问代码需要public和open级别的关键词支撑。但是主工程并不是对外模块，为了测试修改访问权限是不应该的，所以有了<code>@testable</code>关键词。使用如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import XCTest</span><br><span class="line">@testable import Project</span><br><span class="line"></span><br><span class="line">class ProjectTests: XCTestCase &#123;</span><br><span class="line">  &#x2F;* code *&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时测试模块就可以访问那些标记为internal或者public级别的类和成员了。</p>
<h3 id="frozen-和-unknown-default"><a href="#frozen-和-unknown-default" class="headerlink" title="@frozen 和@unknown default"></a>@frozen 和@unknown default</h3><p>frozen意为冻结，是为Swift5的ABI稳定准备的一个字段，意味向编译器保证之后不会做出改变。为什么需要这么做以及这么做有什么好处，他们和ABI稳定是息息相关的，内容有点多就不放这里了，之后会单独出一篇文章介绍，这里只介绍这两个字段的含义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@frozen public enum ComparisonResult : Int &#123;</span><br><span class="line">    case orderedAscending &#x3D; -1</span><br><span class="line">    case orderedSame &#x3D; 0</span><br><span class="line">    case orderedDescending &#x3D; 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@frozen public struct String &#123;&#125;</span><br><span class="line"></span><br><span class="line">extension AVPlayerItem &#123;</span><br><span class="line">  public enum Status : Int &#123;</span><br><span class="line">    case unknown &#x3D; 0</span><br><span class="line">    case readyToPlay &#x3D; 1</span><br><span class="line">    case failed &#x3D; 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ComparisonResult</code>这个枚举值被标记为<code>@frozen</code>即使保证之后该枚举值不会再变。注意到<code>String</code>作为结构体也被标记为<code>@frozen</code>，意为String结构体的属性及属性顺序将不再变化。其实我们常用的类型像<code>Int</code>、<code>Float</code>、<code>Array</code>、<code>Dictionary</code>、<code>Set</code>等都已被“冻结”。需要说明的是冻结仅针对<code>struct</code>和<code>enum</code>这种值类型，因为他们在编译器就确定好了内存布局。对于class类型，不存在是否冻结的概念，可以想下为什么。</p>
<p>对于没有标记为frozen的枚举<code>AVPlayerItem.Status</code>，则认为该枚举值在之后的系统版本中可能变化。</p>
<p>对于可能变化的枚举，我们在列出所有case的时候还需要加上对<code>@unknown default</code>的判断，这一步会有编译器检查：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">switch currentItem.status &#123;</span><br><span class="line">    case .readyToPlay:</span><br><span class="line">        &#x2F;* code *&#x2F;</span><br><span class="line">    case .failed:</span><br><span class="line">        &#x2F;* code *&#x2F;</span><br><span class="line">    case .unknown:</span><br><span class="line">        &#x2F;* code *&#x2F;</span><br><span class="line">    @unknown default:</span><br><span class="line">        fatalError(&quot;not supported&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="State、-Binding、-ObservedObject、-EnvironmentObject"><a href="#State、-Binding、-ObservedObject、-EnvironmentObject" class="headerlink" title="@State、@Binding、@ObservedObject、@EnvironmentObject"></a>@State、@Binding、@ObservedObject、@EnvironmentObject</h3><p>这几个是SwiftUI中出现的特性修饰词，因为我对SwiftUI的了解不多，这里就不做解释了。附一篇文章供大家了解。</p>
<p><a href="https://juejin.im/post/5d625c01f265da03cd0a8a58">[译]理解 SwiftUI 里的属性装饰器@State, @Binding, @ObservedObject, @EnvironmentObject</a></p>
<h2 id="几个重要关键词"><a href="#几个重要关键词" class="headerlink" title="几个重要关键词"></a><strong>几个重要关键词</strong></h2><h3 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h3><p>lazy是懒加载的关键词，当我们仅需要在使用时进行初始化操作就可以选用该关键词。举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Avatar &#123;</span><br><span class="line">  lazy var smallImage: UIImage &#x3D; self.largeImage.resizedTo(Avatar.defaultSmallSize)</span><br><span class="line">  var largeImage: UIImage</span><br><span class="line"></span><br><span class="line">  init(largeImage: UIImage) &#123;</span><br><span class="line">    self.largeImage &#x3D; largeImage</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于smallImage，我们声明了lazy，如果我们不去调用它是不会走后面的图片缩放计算的。但是如果没有lazy，因为是初始化方法，它会直接计算出smallImage的值。所以lazy很好的避免的不必要的计算。</p>
<p>另一个常用lazy的地方是对于UI属性的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lazy var dayLabel: UILabel &#x3D; &#123;</span><br><span class="line">    let label &#x3D; UILabel()</span><br><span class="line">   label.text &#x3D; self.todayText()</span><br><span class="line">    return label</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<p>这里使用的是一个闭包，当调用该属性时，执行闭包里面的内容，返回具体的label，完成初始化。</p>
<p>使用lazy你可能会发现它只能通过var初始而不能通过let，这是由 <code>lazy</code> 的具体实现细节决定的：它在没有值的情况下以某种方式被初始化，然后在被访问时改变自己的值，这就要求该属性是可变的。</p>
<p>另外我们可以在Sequences中使用lazy，在讲解它之前我们先看一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func increment(x: Int) -&gt; Int &#123;</span><br><span class="line">  print(&quot;Computing next value of \(x)&quot;)</span><br><span class="line">  return x+1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let array &#x3D; Array(0..&lt;1000)</span><br><span class="line">let incArray &#x3D; array.map(increment)</span><br><span class="line">print(&quot;Result:&quot;)</span><br><span class="line">print(incArray[0], incArray[4])</span><br></pre></td></tr></table></figure>

<p>在执行<code>print(&quot;Result:&quot;)</code>之前，<code>Computing next value of ...</code>会被执行1000次，但实际上我们只需要0和4这两个index对应的值。</p>
<p>上面说了序列也可以使用lazy，使用的方式是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let array &#x3D; Array(0..&lt;1000)</span><br><span class="line">let incArray &#x3D; array.lazy.map(increment)</span><br><span class="line">print(&quot;Result:&quot;)</span><br><span class="line">print(incArray[0], incArray[4])</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Result:</span><br><span class="line">&#x2F;&#x2F; 1 5</span><br></pre></td></tr></table></figure>

<p>在执行<code>print(&quot;Result:&quot;)</code>之前，并不会打印任何东西，只打印了我们用到的1和5。就是说这里的lazy可以延迟到我们取值时才去计算map里的结果。</p>
<p>我们看下这个lazy的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inlinable public var lazy: LazySequence&lt;Array&lt;Element&gt;&gt; &#123; get &#125;</span><br></pre></td></tr></table></figure>

<p>它返回一个<code>LazySequence</code>的结构体，这个结构体里面包含了<code>Array</code>，而<code>map</code>的计算在<code>LazySequence</code>里又重新定义了一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F; Returns a &#96;LazyMapSequence&#96; over this &#96;Sequence&#96;.  The elements of</span><br><span class="line">&#x2F;&#x2F;&#x2F; the result are computed lazily, each time they are read, by</span><br><span class="line">&#x2F;&#x2F;&#x2F; calling &#96;transform&#96; function on a base element.</span><br><span class="line">@inlinable public func map&lt;U&gt;(_ transform: @escaping (Base.Element) -&gt; U) -&gt; LazyMapSequence&lt;Base, U&gt;</span><br></pre></td></tr></table></figure>

<p>这里完成了lazy序列的实现。<code>LazySequence</code>类型的lazy只能被用于map、flatMap、compactMap这样的高阶函数中。</p>
<p><strong>参考</strong>： <a href="https://swift.gg/2016/03/25/being-lazy/">“懒”点儿好</a></p>
<p><strong>纠错</strong>：参考文章中说：”这些类型（LazySequence）只能被用在 <code>map</code>，<code>flatMap</code>，<code>filter</code>这样的高阶函数中” 其实是没有filter的，因为filter是过滤函数，它需要完整遍历一遍序列才能完成过滤操作，是无法懒加载的，而且我查了<code>LazySequence</code>的定义，确实是没有<code>filter</code>函数的。</p>
<h3 id="unowned-weak"><a href="#unowned-weak" class="headerlink" title="unowned weak"></a>unowned weak</h3><p>Swift开发过程中我们会经常跟闭包打交道，而用到闭包就不可避免的遇到循环引用问题。在Swift处理循环引用可以使用<code>unowned</code>和<code>weak</code>这两个关键词。看下面两个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Dog &#123;</span><br><span class="line">    var name: String</span><br><span class="line">    init (name: String ) &#123;</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">    &#125;</span><br><span class="line">    deinit &#123;</span><br><span class="line">        print(&quot;\(name) is deinitialized&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Bone &#123;</span><br><span class="line">   &#x2F;&#x2F; weak 修饰词</span><br><span class="line">    weak var owner: Dog?</span><br><span class="line">    init(owner: Dog?) &#123;</span><br><span class="line">        self.owner &#x3D; owner</span><br><span class="line">    &#125;</span><br><span class="line">    deinit &#123;</span><br><span class="line">        print(&quot;bone is deinitialized&quot; )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var lucky: Dog? &#x3D; Dog(name: &quot;Lucky&quot;)</span><br><span class="line">var bone: Bone? &#x3D; Bone(owner: lucky!)</span><br><span class="line">lucky &#x3D;  nil</span><br><span class="line">&#x2F;&#x2F; Lucky is deinitialized</span><br></pre></td></tr></table></figure>

<p>这里Dog和Bone是相互引用的关系，如果没有<code>weak var owner: Dog?</code>这里的weak声明，将不会打印<code>Lucky is deinitialized</code>。还有一种解决循环应用的方式是把<code>weak</code>替换为<code>unowned</code>关键词。</p>
<ul>
<li>weak相当于oc里面的weak，弱引用，不会增加循环计数。主体对象释放时被weak修饰的属性也会被释放，所以weak修饰对象就是optional。</li>
<li>unowned相当于oc里面的<code>unsafe_unretained</code>，它不会增加引用计数，即使它的引用对象释放了，它仍然会保持对被已经释放了的对象的一个 “无效的” 引用，它不能是 Optional 值，也不会被指向 <code>nil</code>。如果此时为无效引用，再去尝试访问它就会crash。</li>
</ul>
<p>这两者还有一个更常用的地方是在闭包里面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lazy var someClosure: () -&gt; Void &#x3D; &#123; [weak self] in</span><br><span class="line">    &#x2F;&#x2F; 被weak修饰后self为optional，这里是判断self非空的操作                                </span><br><span class="line">    guard let self &#x3D; self else &#123; retrun &#125;</span><br><span class="line">    self.doSomethings()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里如果是<code>unowned</code>修饰self的话，就不需要用guard做解包操作了。但是我们不能为了省略解包的操作就用<code>unowned</code>，也不能为了安全起见全部<code>weak</code>，弄清楚两者的适用场景非常重要。</p>
<p>根据苹果的建议：</p>
<blockquote>
<p>Define a capture in a closure as an unowned reference when the closure and the instance it captures will always refer to each other, and will always be deallocated at the same time.</p>
</blockquote>
<p>当闭包和它捕获的实例总是相互引用，并且总是同时释放时，即相同的生命周期，我们应该用unowned，除此之外的场景就用weak。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/1726adc72b8ad049.png" alt="img">img</p>
<p>参考：<a href="https://swifter.tips/retain-cycle/">内存管理，WEAK 和 UNOWNED</a></p>
<p><a href="https://swift.gg/2017/05/16/unowned-or-weak-lifetime-and-performance/">Unowned 还是 Weak？生命周期和性能对比</a></p>
<h3 id="KeyPath"><a href="#KeyPath" class="headerlink" title="KeyPath"></a>KeyPath</h3><p>KeyPath是键值路径，最开始是用于处理KVC和KVO问题，后来又做了更广泛的扩展。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; KVC问题，支持struct、class</span><br><span class="line">struct User &#123;</span><br><span class="line">    let name: String</span><br><span class="line">    var age: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var user1 &#x3D; User()</span><br><span class="line">user1.name &#x3D; &quot;ferry&quot;</span><br><span class="line">user1.age &#x3D; 18</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;使用KVC取值</span><br><span class="line">let path: KeyPath &#x3D; \User.name</span><br><span class="line">user1[keyPath: path] &#x3D; &quot;zhang&quot;</span><br><span class="line">let name &#x3D; user1[keyPath: path]</span><br><span class="line">print(name) &#x2F;&#x2F;zhang</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; KVO的实现还是仅限于继承自NSObject的类型</span><br><span class="line">&#x2F;&#x2F; playItem为AVPlayerItem对象</span><br><span class="line">playItem.observe(\.status, changeHandler: &#123; (_, change) in</span><br><span class="line">    &#x2F;* code *&#x2F;    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这个KeyPath的定义是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class AnyKeyPath : Hashable, _AppendKeyPath &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; A partially type-erased key path, from a concrete root type to any</span><br><span class="line">&#x2F;&#x2F;&#x2F; resulting value type.</span><br><span class="line">public class PartialKeyPath&lt;Root&gt; : AnyKeyPath &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; A key path from a specific root type to a specific resulting value type.</span><br><span class="line">public class KeyPath&lt;Root, Value&gt; : PartialKeyPath&lt;Root&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>定义一个<code>KeyPath</code>需要指定两个类型，根类型和对应的结果类型。对应上面示例中的path：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let path: KeyPath&lt;User, String&gt; &#x3D; \User.name</span><br></pre></td></tr></table></figure>

<p>根类型就是User，结果类型就是String。也可以不指定，因为编译器可以从<code>\User.name</code>推断出来。那为什么叫根类型的？可以注意到KeyPath遵循一个协议<code>_AppendKeyPath</code>，它里面定义了很多<code>append</code>的方法，KeyPath是多层可以追加的，就是如果属性是自定义的Address类型，形如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct Address &#123;</span><br><span class="line">    var country: String &#x3D; &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">let path: KeyPath&lt;User, String&gt; &#x3D; \User.address.country</span><br></pre></td></tr></table></figure>

<p>这里根类型为<code>User</code>，次级类型是<code>Address</code>，结果类型是<code>String</code>。所以<code>path</code>的类型依然是<code>KeyPath</code>。</p>
<p>明白了这些我们可以用KeyPath做一些扩展：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">extension Sequence &#123;</span><br><span class="line">    func sorted&lt;T: Comparable&gt;(by keyPath: KeyPath&lt;Element, T&gt;) -&gt; [Element] &#123;</span><br><span class="line">        return sorted &#123; a, b in</span><br><span class="line">            return a[keyPath: keyPath] &lt; b[keyPath: keyPath]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; users is Array&lt;User&gt;</span><br><span class="line">let newUsers &#x3D; users.sorted(by: \.age)</span><br></pre></td></tr></table></figure>

<p>这个自定义<code>sorted</code>函数实现了通过传入keyPath进行升序排列功能。</p>
<p>参考：<a href="https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/">The power of key paths in Swift</a></p>
<h3 id="some"><a href="#some" class="headerlink" title="some"></a>some</h3><p><code>some</code>是Swift5.1新增的特性。它的用法就是修饰在一个 protocol 前面，默认场景下 protocol 是没有具体类型信息的，但是用 <code>some</code> 修饰后，编译器会让 protocol 的实例类型对外透明。</p>
<p>可以通过一个例子理解这段话的含义，当我们尝试定义一个遵循<code>Equatable</code>协议的value时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Protocol &#39;Equatable&#39; can only be used as a generic constraint because it has Self or associated type requirements</span><br><span class="line">var value: Equatable &#123;</span><br><span class="line">    return 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var value: Int &#123;</span><br><span class="line">    return 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器提示我们<code>Equatable</code>只能被用来做泛型的约束，它不是一个具体的类型，这里我们需要使用一个遵循<code>Equatable</code>的具体类型（Int）进行定义。但有时我们并不想指定具体的类型，这时就可以在协议名前加上<code>some</code>，让编译器自己去推断value的类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var value: some Equatable &#123;</span><br><span class="line">    return 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SwiftUI里some随处可见：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct ContentView: View &#123;</span><br><span class="line">    var body: some View &#123;</span><br><span class="line">        Text(&quot;Hello World&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里使用<code>some</code>就是因为<code>View</code>是一个协议，而不是具体类型。</p>
<p>当我们尝试欺骗编译器，每次随机返回不同的<code>Equatable</code>类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var value: some Equatable &#123;</span><br><span class="line">    if Bool.random() &#123;</span><br><span class="line">        return 1</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return &quot;1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>聪明的编译器是会发现的，并警告我们<code>Function declares an opaque return type, but the return statements in its body do not have matching underlying types</code>。</p>
<p>参考：<a href="https://onevcat.com/2019/06/swift-ui-firstlook/">SwiftUI 的一些初步探索 (一)</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/IMG_2555.jpg" alt="IMG_2555"></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/22/ios_code_checker/"><i class="fas fa-angle-double-right"></i>如何通过静态分析提高iOS代码质量</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-22T03:28:09.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-05-22</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-23T23:20:45.539Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-24</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    28 分钟 读完 (大约 4241 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/22/ios_code_checker/">如何通过静态分析提高iOS代码质量</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235171e5857002-20200524072010074.png" alt=""><br>随着项目的扩大，依靠人工codereview来保证项目的质量，越来越不现实，这时就有必要借助于一种自动化的代码审查工具：<strong>程序静态分析</strong>。</p>
<p>程序静态分析（Program Static Analysis）是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描，验证代码是否满足规范性、安全性、可靠性、可维护性等指标的一种代码分析技术。（来自百度百科）</p>
<p>词法分析，语法分析等工作是由编译器进行的，所以对iOS项目为了完成静态分析，我们需要借助于编译器。对于OC语言的静态分析可以完全通过<a href="http://clang.llvm.org/">Clang</a>，对于Swift的静态分析除了Clange还需要借助于<a href="http://www.jpsim.com/uncovering-sourcekit">SourceKit</a>。</p>
<p>Swift语言对应的静态分析工具是SwiftLint，OC语言对应的静态分析工具有Infer和OCLitn。以下会是对各个静态分析工具的安装和使用做一个介绍。</p>
<h2 id="SwiftLint"><a href="#SwiftLint" class="headerlink" title="SwiftLint"></a>SwiftLint</h2><p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/172350fedc7e6aa2-20200524072022825.png" alt=""><br>对于Swift项目的静态分析可以使用<a href="https://github.com/realm/SwiftLint">SwiftLint</a>。SwiftLint 是一个用于强制检查 Swift 代码风格和规定的一个工具。它的实现是 Hook 了 Clang 和 SourceKit 从而能够使用 <a href="http://clang.llvm.org/docs/IntroductionToTheClangAST.html">AST</a> 来表示源代码文件的更多精确结果。Clange我们了解了，那SourceKit是干什么用的？</p>
<p>SourceKit包含在<a href="https://github.com/apple/swift/tree/master/tools/SourceKit">Swift</a>项目的主仓库，它是一套工具集，支持Swift的大多数源代码操作特性：源代码解析、语法突出显示、排版、自动完成、跨语言头生成等工作。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装有两种方式，任选其一：</p>
<p><strong>方式一：通过Homebrew</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install swiftlint</span><br></pre></td></tr></table></figure>

<p>这种是全局安装，各个应用都可以使用。</p>
<p><strong>方式二：通过CocoaPods</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &#39;SwiftLint&#39;, :configurations &#x3D;&gt; [&#39;Debug&#39;]</span><br></pre></td></tr></table></figure>

<p>这种方式相当于把SwiftLint作为一个三方库集成进了项目，因为它只是调试工具，所以我们应该将其指定为仅Debug环境下生效。</p>
<h3 id="集成进Xcode"><a href="#集成进Xcode" class="headerlink" title="集成进Xcode"></a>集成进Xcode</h3><p>我们需要在项目中的<code>Build Phases</code>，添加一个<code>Run Script Phase</code>。如果是通过homebrew安装的，你的脚本应该是这样的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if which swiftlint &gt;/dev/null; then</span><br><span class="line">  swiftlint</span><br><span class="line">else</span><br><span class="line">  echo "warning: SwiftLint not installed, download from https://github.com/realm/SwiftLint"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>如果是通过cocoapods安装的，你得脚本应该是这样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"$&#123;PODS_ROOT&#125;/SwiftLint/swiftlint"</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc122be19a-20200524072035061.png" alt=""></p>
<h3 id="运行SwiftLint"><a href="#运行SwiftLint" class="headerlink" title="运行SwiftLint"></a>运行SwiftLint</h3><p>键入<code>CMD + B</code>编译项目，在编译完后会运行我们刚才加入的脚本，之后我们就能看到项目中大片的警告信息。有时候build信息并不能填入项目代码中，我们可以在编译的log日志里查看。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecc11c4f792-20200524071349318.png" alt=""></p>
<h3 id="定制"><a href="#定制" class="headerlink" title="定制"></a>定制</h3><p>SwiftLint规则太多了，如果我们不想执行某一规则，或者想要滤掉对Pods库的分析，我们可以对SwfitLint进行配置。</p>
<p>在项目根目录新建一个<code>.swiftlint.yml</code>文件，然后填入如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disabled_rules:</span> <span class="comment"># rule identifiers to exclude from running</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">colon</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">trailing_whitespace</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">vertical_whitespace</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">function_body_length</span></span><br><span class="line"><span class="attr">opt_in_rules:</span> <span class="comment"># some rules are only opt-in</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">empty_count</span></span><br><span class="line">  <span class="comment"># Find all the available rules by running:</span></span><br><span class="line">  <span class="comment"># swiftlint rules</span></span><br><span class="line"><span class="attr">included:</span> <span class="comment"># paths to include during linting. `--path` is ignored if present.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source</span></span><br><span class="line"><span class="attr">excluded:</span> <span class="comment"># paths to ignore during linting. Takes precedence over `included`.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Carthage</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Pods</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source/ExcludedFolder</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source/ExcludedFile.swift</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Source/*/ExcludedFile.swift</span> <span class="comment"># Exclude files with a wildcard</span></span><br><span class="line"><span class="attr">analyzer_rules:</span> <span class="comment"># Rules run by `swiftlint analyze` (experimental)</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">explicit_self</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># configurable rules can be customized from this configuration file</span></span><br><span class="line"><span class="comment"># binary rules can set their severity level</span></span><br><span class="line"><span class="attr">force_cast:</span> <span class="string">warning</span> <span class="comment"># implicitly</span></span><br><span class="line"><span class="attr">force_try:</span></span><br><span class="line"><span class="attr">  severity:</span> <span class="string">warning</span> <span class="comment"># explicitly</span></span><br><span class="line"><span class="comment"># rules that have both warning and error levels, can set just the warning level</span></span><br><span class="line"><span class="comment"># implicitly</span></span><br><span class="line"><span class="attr">line_length:</span> <span class="number">110</span></span><br><span class="line"><span class="comment"># they can set both implicitly with an array</span></span><br><span class="line"><span class="attr">type_body_length:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="number">300</span> <span class="comment"># warning</span></span><br><span class="line"><span class="bullet">  -</span> <span class="number">400</span> <span class="comment"># error</span></span><br><span class="line"><span class="comment"># or they can set both explicitly</span></span><br><span class="line"><span class="attr">file_length:</span></span><br><span class="line"><span class="attr">  warning:</span> <span class="number">500</span></span><br><span class="line"><span class="attr">  error:</span> <span class="number">1200</span></span><br><span class="line"><span class="comment"># naming rules can set warnings/errors for min_length and max_length</span></span><br><span class="line"><span class="comment"># additionally they can set excluded names</span></span><br><span class="line"><span class="attr">type_name:</span></span><br><span class="line"><span class="attr">  min_length:</span> <span class="number">4</span> <span class="comment"># only warning</span></span><br><span class="line"><span class="attr">  max_length:</span> <span class="comment"># warning and error</span></span><br><span class="line"><span class="attr">    warning:</span> <span class="number">40</span></span><br><span class="line"><span class="attr">    error:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">  excluded:</span> <span class="string">iPhone</span> <span class="comment"># excluded via string</span></span><br><span class="line"><span class="attr">  allowed_symbols:</span> <span class="string">["_"]</span> <span class="comment"># these are allowed in type names</span></span><br><span class="line"><span class="attr">identifier_name:</span></span><br><span class="line"><span class="attr">  min_length:</span> <span class="comment"># only min_length</span></span><br><span class="line"><span class="attr">    error:</span> <span class="number">4</span> <span class="comment"># only error</span></span><br><span class="line"><span class="attr">  excluded:</span> <span class="comment"># excluded via string array</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">id</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">URL</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">GlobalAPIKey</span></span><br><span class="line"><span class="attr">reporter:</span> <span class="string">"xcode"</span> <span class="comment"># reporter type (xcode, json, csv, checkstyle, junit, html, emoji, sonarqube, markdown)</span></span><br></pre></td></tr></table></figure>

<p>一条rules提示如下，其对应的rules名就是<code>function_body_length</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! Function Body Length Violation: Function body should span 40 lines or less excluding comments and whitespace: currently spans 43 lines (function_body_length)</span><br></pre></td></tr></table></figure>

<p><code>disabled_rules</code>下填入我们不想遵循的规则。</p>
<p><code>excluded</code>设置我们想跳过检查的目录，Carthage、Pod、SubModule这些一般可以过滤掉。</p>
<p>其他的一些像是文件长度（file_length），类型名长度（type_name），我们可以通过设置具体的数值来调节。</p>
<p>另外SwiftLint也支持自定义规则，我们可以根据自己的需求，定义自己的<code>rule</code>。</p>
<h3 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h3><p>如果我们想将此次分析生成一份报告，也是可以的（该命令是通过homebrew安装的swiftlint）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reporter type (xcode, json, csv, checkstyle, junit, html, emoji, sonarqube, markdown)</span></span><br><span class="line">$ swiftlint lint --reporter html &gt; swiftlint.html</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecffbd58df9-20200524071402318.png" alt=""></p>
<h2 id="xcodebuild"><a href="#xcodebuild" class="headerlink" title="xcodebuild"></a>xcodebuild</h2><p>xcodebuild是xcode内置的编译命令，我们可以用它来编译打包我们的iOS项目，接下来介绍的Infer和OCLint都是基于xcodebuild的编译产物进行分析的，所以有必要简单介绍一下它。</p>
<p>一般编译一个项目，我们需要指定项目名，configuration，scheme，sdk等信息以下是几个简单的命令及说明。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 不带pod的项目，target名为TargetName，在Debug下，指定模拟器sdk环境进行编译</span></span><br><span class="line">xcodebuild -target TargetName -configuration Debug -sdk iphonesimulator</span><br><span class="line"><span class="meta">#</span><span class="bash"> 带pod的项目，workspace名为TargetName.xcworkspace，在Release下，scheme为TargetName，指定真机环境进行编译。不指定模拟器环境会验证证书</span></span><br><span class="line">xcodebuild -workspace WorkspaceName.xcworkspace -scheme SchemeName Release</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清楚项目的编译产物</span></span><br><span class="line">xcodebuild -workspace WorkspaceName.xcworkspace -scheme SchemeName Release clean</span><br></pre></td></tr></table></figure>

<p><strong>之后对xcodebuild命令的使用都需要将这些参数替换为自己项目的参数。</strong></p>
<h2 id="Infer"><a href="#Infer" class="headerlink" title="Infer"></a>Infer</h2><p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17235114be547093-20200524071413231.png" alt=""><br><a href="https://infer.liaohuqiu.net/">Infer</a>是Facebook开发的针对C、OC、Java语言的静态分析工具，它同时支持对iOS和Android应用的分析。对于Facebook内部的应用像是 Messenger、Instagram 和其他一些应用均是有它进行静态分析的。它主要检测隐含的问题，主要包括以下几条：</p>
<ul>
<li>资源泄露，内存泄露</li>
<li>变量和参数的非空检测</li>
<li>循环引用</li>
<li>过早的nil操作</li>
</ul>
<p>暂不支持自定义规则。</p>
<h3 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install infer</span><br></pre></td></tr></table></figure>


<p>运行infer</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> projectDir</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 跳过对Pods的分析</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> infer run --skip-analysis-in-path Pods -- xcodebuild -workspace <span class="string">"Project.xcworkspace"</span> -scheme <span class="string">"Scheme"</span> -configuration Debug -sdk iphonesimulator</span></span><br></pre></td></tr></table></figure>

<p>我们会得到一个<code>infer-out</code>的文件夹，里面是各种代码分析的文件，有txt，json等文件格式，当这样不方便查看，我们可以将其转成html格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ infer explore --html</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234ecf28954fee-20200524071427211.png" alt=""></p>
<p>点击trace，我们会看到该问题代码的上下文。</p>
<p>因为Infer默认是增量编译，只会分析变动的代码，如果我们想整体编译的话，需要clean一下项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcodebuild -workspace <span class="string">"Project.xcworkspace"</span> -scheme <span class="string">"Scheme"</span> -configuration Debug -sdk iphonesimulator clean</span></span><br></pre></td></tr></table></figure>

<p>再次运行Infer去编译。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ infer run --skip-analysis-in-path Pods -- xcodebuild -workspace <span class="string">"Project.xcworkspace"</span> -scheme <span class="string">"Scheme"</span> -configuration Debug -sdk iphonesimulator</span><br></pre></td></tr></table></figure>

<h3 id="Infer的大致原理"><a href="#Infer的大致原理" class="headerlink" title="Infer的大致原理"></a>Infer的大致原理</h3><p>Infer的静态分析主要分两个阶段：</p>
<p><strong>1、捕获阶段</strong></p>
<p>Infer 捕获编译命令，将文件翻译成 Infer 内部的中间语言。</p>
<p>这种翻译和编译类似，Infer 从编译过程获取信息，并进行翻译。这就是我们调用 Infer 时带上一个编译命令的原因了，比如: <code>infer -- clang -c file.c</code>, <code>infer -- javac File.java</code>。结果就是文件照常编译，同时被 Infer 翻译成中间语言，留作第二阶段处理。特别注意的就是，如果没有文件被编译，那么也没有任何文件会被分析。</p>
<p>Infer 把中间文件存储在结果文件夹中，一般来说，这个文件夹会在运行 <code>infer</code> 的目录下创建，命名是 <code>infer-out/</code>。</p>
<p><strong>2、分析阶段</strong></p>
<p>在分析阶段，Infer 分析 <code>infer-out/</code> 下的所有文件。分析时，会单独分析每个方法和函数。</p>
<p>在分析一个函数的时候，如果发现错误，将会停止分析，但这不影响其他函数的继续分析。</p>
<p>所以你在检查问题的时候，修复输出的错误之后，需要继续运行 Infer 进行检查，知道确认所有问题都已经修复。</p>
<p>错误除了会显示在标准输出之外，还会输出到文件 <code>infer-out/bug.txt</code> 中，我们过滤这些问题，仅显示最有可能存在的。</p>
<p>在结果文件夹中（<code>infer-out</code>），同时还有一个 csv 文件 <code>report.csv</code>，这里包含了所有 Infer 产生的信息，包括：错误，警告和信息。</p>
<h2 id="OCLint"><a href="#OCLint" class="headerlink" title="OCLint"></a>OCLint</h2><p><a href="http://oclint.org/">OCLint</a>是基于<a href="http://clang.llvm.org/docs/LibTooling.html">Clange Tooling</a>编写的库，它支持扩展，检测的范围比Infer要大。不光是隐藏bug，一些代码规范性的问题，例如命名和函数复杂度也均在检测范围之内。</p>
<h4 id="安装OCLint"><a href="#安装OCLint" class="headerlink" title="安装OCLint"></a>安装OCLint</h4><p>OCLint一般通过Homebrew安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap oclint/formulae   </span><br><span class="line">$ brew install oclint</span><br></pre></td></tr></table></figure>

<p>通过Hombrew安装的版本为0.13。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ oclint --version</span><br><span class="line">LLVM (http://llvm.org/):</span><br><span class="line">  LLVM version 5.0.0svn-r313528</span><br><span class="line">  Optimized build.</span><br><span class="line">  Default target: x86_64-apple-darwin19.0.0</span><br><span class="line">  Host CPU: skylake</span><br><span class="line"></span><br><span class="line">OCLint (http://oclint.org/):</span><br><span class="line">  OCLint version 0.13.</span><br><span class="line">  Built Sep 18 2017 (08:58:40).</span><br></pre></td></tr></table></figure>

<p>我分别用Xcode11在两个项目上运行过OCLint，一个实例项目可以正常运行，另一个复杂的项目却运行失败，报如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 error generated</span><br><span class="line">1 error generated</span><br><span class="line">...</span><br><span class="line">oclint: error: cannot open report output file ..../onlintReport.html</span><br></pre></td></tr></table></figure>

<p>我并不清楚原因，如果你想试试0.13能否使用的话，直接跳到安装xcpretty。如果你也遇到了这个问题，可以回来安装oclint0.15版本。</p>
<h4 id="OCLint0-15"><a href="#OCLint0-15" class="headerlink" title="OCLint0.15"></a>OCLint0.15</h4><p>我在<a href="https://github.com/oclint/oclint/issues/547">oclint issuse #547</a>这里找到了这个问题和对应的解决方案。</p>
<p>我们需要更新oclint至0.15版本。brew上的最新版本是0.13，github上的最新版本是0.15。我下载github上的release0.15版本，但是这个包并不是编译过的，不清楚是不是官方自己搞错了，只能手动编译了。因为编译要下载llvm和clange，这两个包较大，所以我将编译过后的包直接传到了这里<a href="https://github.com/zhangferry/CodeChecker">CodeChecker</a>。</p>
<p>如果不关心编译过程，可以下载编译好的包，跳到设置环境变量那一步。</p>
<p><strong>编译OCLint</strong></p>
<p>1、安装<a href="https://cmake.org/">CMake</a>和<a href="https://ninja-build.org/">Ninja</a>这两个编译工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install cmake ninja</span><br></pre></td></tr></table></figure>

<p>2、clone OCLint项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/oclint/oclint</span><br></pre></td></tr></table></figure>

<p>3、进入oclint-scripts目录，执行make命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./make</span><br></pre></td></tr></table></figure>

<p>成功之后会出现build文件夹，里面有个oclint-release就是编译成功的oclint工具。</p>
<p><strong>设置oclint工具的环境变量</strong></p>
<p>设置环境变量的目的是为了我们能够快捷访问。然后我们需要配置PATH环境变量，注意OCLint_PATH的路径为你存放oclint-release的路径。将其添加到<code>.zshrc</code>，或者<code>.bash_profile</code>文件末尾:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OCLint_PATH=/Users/zhangferry/oclint/build/oclint-release</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$OCLint_PATH</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>执行<code>source .zshrc</code>，刷新环境变量，然后验证oclint是否安装成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ oclint --version</span><br><span class="line">OCLint (http://oclint.org/):</span><br><span class="line">OCLint version 0.15.</span><br><span class="line">Built May 19 2020 (11:48:49).</span><br></pre></td></tr></table></figure>

<p>出现这个介绍就说明我们已经完成了安装。</p>
<h3 id="安装xcpretty"><a href="#安装xcpretty" class="headerlink" title="安装xcpretty"></a>安装xcpretty</h3><p>xcpretty是一个格式化xcodebuild输出内容的脚本工具，oclint的解析依赖于它的输出。它的安装方式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gem install xcpretty</span></span><br></pre></td></tr></table></figure>

<h3 id="OCLint的使用"><a href="#OCLint的使用" class="headerlink" title="OCLint的使用"></a>OCLint的使用</h3><p>在使用OCLint之前还需要一些准备工作，需要将编译项<code>COMPILER_INDEX_STORE_ENABLE</code>设置为NO。</p>
<ul>
<li>将 Project 和 Targets 中 Building Settings 下的 <code>COMPILER_INDEX_STORE_ENABLE</code> 设置为 <strong>NO</strong></li>
<li>在 podfile 中 <strong>target ‘target’ do 前面</strong>添加下面的脚本，将各个pod的编译配置也改为此选项</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">post_install <span class="keyword">do</span> <span class="params">|installer|</span></span><br><span class="line">  installer.pods_project.targets.each <span class="keyword">do</span> <span class="params">|target|</span></span><br><span class="line">      target.build_configurations.each <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">          config.build_settings[<span class="string">'COMPILER_INDEX_STORE_ENABLE'</span>] = <span class="string">"NO"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><p>1、进入项目根目录，运行如下脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcodebuild -workspace ProjectName.xcworkspace -scheme ProjectScheme -configuration Debug -sdk iphonesimulator | xcpretty -r json-compilation-database -o compile_commands.json</span></span><br></pre></td></tr></table></figure>

<p>会将xcodebuild编译过程中的一些信息记录成一个文件<code>compile_commands.json</code>，如果我们在项目根目录看到了该文件，且里面是有内容的，证明我们完成了第一步。</p>
<p>2、我们将这个json文件转成方便查看的html，过滤掉对Pods文件的分析，为了防止行数上限，我们加上行数的限制：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> oclint-json-compilation-database -e Pods -- -report-type html -o oclintReport.html -rc LONG_LINE=9999 -max-priority-1=9999 -max-priority-2=9999 -max-priority-3=9999</span></span><br></pre></td></tr></table></figure>

<p>最终会产生一个<code>oclintReport.html</code>文件。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234f0bd08b57c8-20200524071439420.png" alt=""></p>
<p>OCLint支持自定义规则，因为其本身规则已经很丰富了，自定义规则的需求应该很小，也就没有尝试。</p>
<p><strong>封装脚本</strong></p>
<p>OCLint跟Infer一样都是通过运行几个脚本语言进行执行的，我们可以将这几个命令封装成一个脚本文件，以OCLint为例，Infer也类似：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mark sure you had install the oclint and xcpretty</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> You need to replace these values with your own project configuration</span></span><br><span class="line">workspace_name="WorkSpaceName.xcworkspace"</span><br><span class="line">scheme_name="SchemeName"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> remove <span class="built_in">history</span></span></span><br><span class="line">rm compile_commands.json</span><br><span class="line">rm oclint_result.xml</span><br><span class="line"><span class="meta">#</span><span class="bash"> clean project</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -sdk iphonesimulator means run simulator</span></span><br><span class="line">xcodebuild -workspace $workspace_name -scheme $scheme_name -configuration Debug -sdk iphonesimulator clean || (echo "command failed"; exit 1);</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> compile_commands.json</span></span><br><span class="line">xcodebuild -workspace $workspace_name -scheme $scheme_name -configuration Debug -sdk iphonesimulator \</span><br><span class="line">| xcpretty -r json-compilation-database -o compile_commands.json \</span><br><span class="line">|| (echo "command failed"; exit 1);</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> report html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you can run `oclint -<span class="built_in">help</span>` to see all USAGE</span></span><br><span class="line">oclint-json-compilation-database -e Pods -- -report-type html -o oclintReport.html \</span><br><span class="line">-disable-rule ShortVariableName \</span><br><span class="line">-rc LONG_LINE=1000 \</span><br><span class="line">|| (echo "command failed"; exit 1);</span><br><span class="line"></span><br><span class="line">open -a "/Applications/Safari.app" oclintReport.html</span><br></pre></td></tr></table></figure>

<p><code>oclint-json-compilation-database</code>命令的几个参数说明：</p>
<p><code>-e</code><br> 需要忽略分析的文件，这些文件的警告不会出现在报告中</p>
<p><code>-rc</code><br> 需要覆盖的规则的阀值，这里可以自定义项目的阀值，<a href="]http://docs.oclint.org/en/stable/howto/thresholds.html#mccabe76">默认阀值</a></p>
<p><code>-enable-rule</code><br> 支持的规则，默认是oclint提供的都支持，可以组合-disable-rule来过滤掉一些规则<br> <a href="http://docs.oclint.org/en/stable/rules/index.html">规则列表</a></p>
<p><code>-disable-rule</code><br> 需要忽略的规则，根据项目需求设置</p>
<h4 id="在Xcode中使用OCLint"><a href="#在Xcode中使用OCLint" class="headerlink" title="在Xcode中使用OCLint"></a>在Xcode中使用OCLint</h4><p>因为OCLint提供了xcode格式的输出样式，所以我们可以将它作为一个脚本放在Xcode中。</p>
<p>1、在项目的 TARGETS 下面，点击下方的 “+” ，选择 cross-platform 下面的 Aggregate。输入名字，这里命名为 OCLint</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc856021e-20200524071454807.png" alt="new_target"></p>
<p>2、选中该Target，进入Build Phases，添加Run Script，写入下面脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Type a script or drag a script file from your workspace to insert its path.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内置变量</span></span><br><span class="line">cd $&#123;SRCROOT&#125;</span><br><span class="line">xcodebuild clean </span><br><span class="line">xcodebuild | xcpretty -r json-compilation-database</span><br><span class="line">oclint-json-compilation-database -e Pods -- -report-type xcode</span><br></pre></td></tr></table></figure>

<p>可以看出该脚本跟上面的脚本一样，只不过 将<code>oclint-json-compilation-database</code>命令的<code>-report-type</code>由<code>html</code>改为了<code>xcode</code>。而OCLint作为一个target本身就运行在特定的环境下，所以xcodebuild可以省去配置参数。</p>
<p>3、通过<code>CMD + B</code>我们编译一下项目，执行脚本任务，会得到能够定位到代码的warning信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/17234eccc81f9502-20200524071506685.png" alt="xcode_warning"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以下是对这几种静态分析方案的对比，我们可以根据需求选择适合自己的静态分析方案。</p>
<table>
<thead>
<tr>
<th></th>
<th>SwiftLint</th>
<th>Infer</th>
<th>OCLint</th>
</tr>
</thead>
<tbody><tr>
<td>支持语言</td>
<td>Swift</td>
<td>C、C++、OC、Java</td>
<td>C、C++、OC</td>
</tr>
<tr>
<td>易用性</td>
<td>简单</td>
<td>较简单</td>
<td>较简单</td>
</tr>
<tr>
<td>能否集成进Xcode</td>
<td>可以</td>
<td>不能集成进xcode</td>
<td>可以</td>
</tr>
<tr>
<td>自带规则丰富度</td>
<td>较多，包含代码规范</td>
<td>相对较少，主要检测潜在问题</td>
<td>较多，包含代码规范</td>
</tr>
<tr>
<td>规则扩展性</td>
<td>可以</td>
<td>不可以</td>
<td>可以</td>
</tr>
</tbody></table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.im/post/5ce9f477f265da1b7c60f4fe#heading-1">OCLint 实现 Code Review - 给你的代码提提质量</a></p>
<p><a href="http://docs.oclint.org/en/stable/guide/xcode.html">Using OCLint in Xcode</a></p>
<p><a href="https://infer.liaohuqiu.net/docs/infer-workflow.html">Infer 的工作机制</a></p>
<p><a href="https://github.com/CYBoys/Blogs/blob/master/LLVM_Clang/LLVM%20%26%20Clang%20%E5%85%A5%E9%97%A8.md">LLVM &amp; Clang 入门</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/10/swift_advance_1/"><i class="fas fa-angle-double-right"></i>Swift进阶黄金之路</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-09T16:00:34.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-05-10</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-31T14:07:49.740Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-31</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    41 分钟 读完 (大约 6075 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/10/swift_advance_1/">Swift进阶黄金之路</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/image-20200511230812677.png" alt="image-20200511230812677"></p>
<p><a href="https://zhangferry.com/2020/05/31/swift_advance_2/">Swift进阶黄金之路（二）</a></p>
<p>这篇是对<a href="https://juejin.im/post/5e96f898e51d4546c27bcf81">一文鉴定是Swift的王者，还是青铜</a>文章中问题的解答。这些问题仅仅是表层概念，属于知识点，在我看来即使都很清楚也并不能代表上了王者，如果非要用段位类比的话，黄金还是合理的😄。</p>
<p>Swift是一门上手容易，但是精通较难的语言。即使下面这些内容都不清楚也不妨碍你开发业务需求，但是了解之后它能够帮助我们写出更加Swifty的代码。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/05/10/swift_advance_1/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/05/ios_photo_format_compare/"><i class="fas fa-angle-double-right"></i>iOS开发图片格式选择</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-05T14:39:34.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-04-05</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-23T22:57:55.402Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-24</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    33 分钟 读完 (大约 5018 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/05/ios_photo_format_compare/">iOS开发图片格式选择</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://cdn.jsdelivr.net/gh/zhangferry/Images/blog/1714d8ba5edf9f51.png" alt=""></p>
<h2 id="图片是如何显示的"><a href="#图片是如何显示的" class="headerlink" title="图片是如何显示的"></a>图片是如何显示的</h2><p>在讲解如何选择图片格式之前，我感觉有必要先了解下，图片是如何展示的。如果我们要展示一张图片，一般步骤是这样的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Assets.xcassets中的图片，不需要后缀</span></span><br><span class="line"><span class="keyword">let</span> image = <span class="type">UIImage</span>(named: <span class="string">"icon"</span>)</span><br><span class="line"><span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(frame: rect)</span><br><span class="line">imageView.image = image</span><br><span class="line">view.addSubview(imageView)</span><br></pre></td></tr></table></figure>

<p>运行程序，我们就可以在指定位置看到这个icon。看似简单的代码背后隐藏了很多细节工作。一张图片的展示，从代码执行到展示出来大致经历了这些步骤：</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/04/05/ios_photo_format_compare/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/28/interview_kuaishou/"><i class="fas fa-angle-double-right"></i>快手iOS面经</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-28T05:11:27.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-03-28</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-23T23:22:29.165Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-24</time>
                                
                
                <div class="level-item">
                <i class="far fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/iOS/">iOS</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    15 分钟 读完 (大约 2196 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/28/interview_kuaishou/">快手iOS面经</a>
            
        </h1> -->
        <div class="content">
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>过完年来北京之后，有准备看看机会，也是想了解下市场行情。简历没有投太多，只定向投了头条教育部门、抖音、快手、阿里，这些公司。头条和阿里的简历都没过，肯定是亮点太少吧。只有快手简历过了，快手是三轮技术面+一轮HR面，前两轮技术都比较顺利，到第三轮却栽了，很痛心o(╥﹏╥)o。目前就不考虑换工作了，等下半年再说了，接下来的时间再好好精炼一下。</p>
<p>快手是视频面试，不支持周末，但是可以选择晚上时间，我这几次都是定在了晚上九点。视频面试是通过牛客网进行的，以下是我还记得下来的各轮面试题，对于一些iOS基础知识就不做解答了。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/03/28/interview_kuaishou/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/23/runtime_objc_class/"><i class="fas fa-angle-double-right"></i>Runtime内存模型探究</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-23T05:28:09.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-02-23</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-04-11T02:38:53.306Z"><i class="far fa-calendar-check">&nbsp;</i>2020-04-11</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    14 分钟 读完 (大约 2081 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/23/runtime_objc_class/">Runtime内存模型探究</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://raw.githubusercontent.com/zhangferry/Images/master/blog/laptop-2838917_1280.jpg" alt=""></p>
<blockquote>
<p>Objective-C是一种通用、高级、面向对象的编程语言。它扩展了标准的ANSI C编程语言，将Smalltalk式的消息传递机制加入到ANSI C中。</p>
</blockquote>
<p>可以这么理解，Objective-C = C + Runtime，Runtime是将C语言具有面向对象功能的推动剂，是iOS开发中的核心概念。我们可以在苹果开源的 <a href="https://opensource.apple.com/tarballs/objc4/">runtime</a>（当前的最新版本objc4-779.1.tar.gz）中可以发现一些 Objective-C 对象模型的实现细节。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/02/23/runtime_objc_class/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/01/vscode_python/"><i class="fas fa-angle-double-right"></i>VSCode配置Python版本</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-01T03:28:09.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-02-01</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-03-08T12:38:19.739Z"><i class="far fa-calendar-check">&nbsp;</i>2020-03-08</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 读完 (大约 1315 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/01/vscode_python/">VSCode配置Python版本</a>
            
        </h1> -->
        <div class="content">
            <p>刚学习Python没多久，对VSCode也不是很熟悉，在一次解问题的过程中，加深了对这两者的印象，于是记录一下。</p>
<p>环境：Mac OS 10.15，VSCode 1.41.1</p>
<h2 id="问题定位"><a href="#问题定位" class="headerlink" title="问题定位"></a>问题定位</h2><p>我在尝试用VSCode写python爬虫，遇到一个问题<code>ImportError: No module named requests</code>。</p>
<p>通过问题描述很容易知道问题，这是因为导入了<code>requests</code>库，但是VSCode却没有找到这个库。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/02/01/vscode_python/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/01/01/2019-year-summary/"><i class="fas fa-angle-double-right"></i>2019年总结</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-01-01T12:10:25.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-01-01</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-03-08T12:38:41.828Z"><i class="far fa-calendar-check">&nbsp;</i>2020-03-08</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    32 分钟 读完 (大约 4786 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/01/01/2019-year-summary/">2019年总结</a>
            
        </h1> -->
        <div class="content">
            <blockquote>
<p>好像随着年龄的增长，对时间的感知就变得越来越弱了。总感觉2019年还是一个很新鲜的年份，但它却已经走完了，2020年好像很遥远的样子，但它已经到来了。来个总结吧，2019年，这一年有太多的酸甜苦辣。从工作、生活和规划三个方面展开说吧。</p>
</blockquote>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p><img src="https://raw.githubusercontent.com/zhangferry/Images/master/blog/thought-catalog-505eectW54k-unsplash.jpg" alt=""></p>
<p>年初原项目组有一位很厉害的开发离职了，当时是我俩共同负责一个项目。他开发经验比我多，而且工作态度和习惯都很好，是我见过的未数不多让我称赞的程序员。曾经一起工作的将近一年多时间里，我都以他为学习榜样。对于他的离职，我纠结了很长一段时间，自认这是对我对公司的一大损失。</p>
<p>后来很长的时间里，一直都没有招到合适的人，我便一个人扛起了项目。很多之前应该是两个人一起商量的问题都需要自己一个人去思考解决方式，渐渐的我不断磨练自己的独立思考能力。大半年下来，突然感觉自己被逼着成长了许多，从一个崇拜别人，向别人学习的角色变成了一个不惧怕任何技术难题，能够帮助别人解决困难的角色。</p>
<p>2019年学会的第一个最重要的道理，<strong>很多时候有一个可以依赖的对象，是会减弱自己探索和尝试的动力，而开发很多时候对技能的理解和掌握，乃至个人进步，都是要依靠自己的探索获取的</strong>。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/01/01/2019-year-summary/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/12/07/transfom_oc_to_swift/"><i class="fas fa-angle-double-right"></i>OC项目转Swift指南</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-12-07T10:28:09.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-12-07</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-03-08T12:38:31.328Z"><i class="far fa-calendar-check">&nbsp;</i>2020-03-08</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    23 分钟 读完 (大约 3480 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/12/07/transfom_oc_to_swift/">OC项目转Swift指南</a>
            
        </h1> -->
        <div class="content">
            <p><img src="https://raw.githubusercontent.com/zhangferry/Images/master/blog/web-3967926_1280.jpg" alt=""></p>
<blockquote>
<p>运行环境：Xcode 11.1 Swift5.0</p>
</blockquote>
<p>最近参与的一个项目需要从Objective-C（以下简称OC）转到Swift，期间遇到了一些坑，于是有了这篇总结性的文档。如果你也有将OC项目Swift化的需求，可以作为参考。</p>
<p>OC转Swift有一个大前提就是你要对Swift有一定的了解，熟悉Swift语法，最好是完整看过一遍官方的<a href="https://docs.swift.org/swift-book/LanguageGuide/TheBasics.html">Language Guide</a>。</p>
<p>转换的过程分自动化和手动转译，鉴于自动化工具的识别率不能让人满意，大部分情况都是需要手动转换的。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/12/07/transfom_oc_to_swift/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/11/22/ios_architecture_patterns/"><i class="fas fa-angle-double-right"></i>【译】iOS 架构模式--浅析MVC, MVP, MVVM 和 VIPER</a>
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-11-22T06:39:34.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-11-22</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-03-08T12:39:27.146Z"><i class="far fa-calendar-check">&nbsp;</i>2020-03-08</time>
                                
                
                
                <span class="level-item has-text-grey">
                    
                    
                    37 分钟 读完 (大约 5554 个字)
                </span>
                
                
            </div>
        </div>
        
        <!-- <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/11/22/ios_architecture_patterns/">【译】iOS 架构模式--浅析MVC, MVP, MVVM 和 VIPER</a>
            
        </h1> -->
        <div class="content">
            <blockquote>
<p>作者：Bohdan Orlov<br>原文地址：<a href="https://medium.com/ios-os-x-development/ios-architecture-patterns-ecba4c38de52">https://medium.com/ios-os-x-development/ios-architecture-patterns-ecba4c38de52</a></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/zhangferry/Images/master/blog/20191122154526.png" alt=""></p>
<p>在iOS开发过程中你是否对MVC的使用感觉很别扭？你是否对转向MVVM有疑惑？你听说过VIPER，但不清楚这个东西是否值得一试。</p>
<p>接着读下去，你会找到上面这些问题的答案。如果读完仍不能解惑，欢迎到评论区捶我。</p>
<p>接下来你将在iOS环境下构建关于架构模式的知识体系。我们将简要构建一些经典的例子，并在理论和实践上进行比较他们的不同。如果你需要更多关于任何一个特定的细节，请关注我。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/11/22/ios_architecture_patterns/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/7/">7</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="zhangferry">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        zhangferry
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        iOS开发
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>北京</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            61
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            4
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            31
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/zhangferry" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/zhangferry">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Weibo" href="https://weibo.com/2947186387/profile">
                
                <i class="fab fa-weibo"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="https://zhangferry.com/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://colin1994.github.io/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Colin</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">colin1994.github.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.evenvi.com/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Evenvi</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.evenvi.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/ANCS/" style="font-size: 10px;">ANCS</a> <a href="/tags/AVPlayer/" style="font-size: 11.67px;">AVPlayer</a> <a href="/tags/Cocoapods/" style="font-size: 10px;">Cocoapods</a> <a href="/tags/DFU/" style="font-size: 10px;">DFU</a> <a href="/tags/Hexo/" style="font-size: 11.67px;">Hexo</a> <a href="/tags/Hybrid/" style="font-size: 10px;">Hybrid</a> <a href="/tags/Notification/" style="font-size: 10px;">Notification</a> <a href="/tags/Swift/" style="font-size: 11.67px;">Swift</a> <a href="/tags/UI/" style="font-size: 13.33px;">UI</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 13.33px;">博客</a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 10px;">工作</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%8B%9B%E8%81%98/" style="font-size: 10px;">招聘</a> <a href="/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/" style="font-size: 10px;">敏捷开发</a> <a href="/tags/%E6%9C%88%E6%8A%A5/" style="font-size: 18.33px;">月报</a> <a href="/tags/%E6%9C%AC%E5%9C%B0%E5%8C%96/" style="font-size: 10px;">本地化</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 16.67px;">生活</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/" style="font-size: 10px;">程序员</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 10px;">翻译</a> <a href="/tags/%E8%93%9D%E7%89%99/" style="font-size: 15px;">蓝牙</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.67px;">设计模式</a> <a href="/tags/%E9%98%85%E8%AF%BB/" style="font-size: 10px;">阅读</a> <a href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/" style="font-size: 10px;">静态分析</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 11.67px;">面试</a> <a href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/" style="font-size: 10px;">黑苹果</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/05/31/swift_advance_2/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Swift进阶黄金之路（二）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-31T14:00:34.000Z">2020-05-31</time></div>
                    <a href="/2020/05/31/swift_advance_2/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Swift进阶黄金之路（二）</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/22/ios_code_checker/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="如何通过静态分析提高iOS代码质量">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-22T03:28:09.000Z">2020-05-22</time></div>
                    <a href="/2020/05/22/ios_code_checker/" class="title has-link-black-ter is-size-6 has-text-weight-normal">如何通过静态分析提高iOS代码质量</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/10/swift_advance_1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Swift进阶黄金之路">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T16:00:34.000Z">2020-05-10</time></div>
                    <a href="/2020/05/10/swift_advance_1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Swift进阶黄金之路</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/05/ios_photo_format_compare/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="iOS开发图片格式选择">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-05T14:39:34.000Z">2020-04-05</time></div>
                    <a href="/2020/04/05/ios_photo_format_compare/" class="title has-link-black-ter is-size-6 has-text-weight-normal">iOS开发图片格式选择</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/28/interview_kuaishou/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="快手iOS面经">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-28T05:11:27.000Z">2020-03-28</time></div>
                    <a href="/2020/03/28/interview_kuaishou/" class="title has-link-black-ter is-size-6 has-text-weight-normal">快手iOS面经</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/iOS/">iOS</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">八月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">六月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ANCS/">
                        <span class="tag">ANCS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AVPlayer/">
                        <span class="tag">AVPlayer</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Cocoapods/">
                        <span class="tag">Cocoapods</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DFU/">
                        <span class="tag">DFU</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hybrid/">
                        <span class="tag">Hybrid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Notification/">
                        <span class="tag">Notification</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Swift/">
                        <span class="tag">Swift</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/iOS/">
                        <span class="tag">iOS</span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2/">
                        <span class="tag">博客</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B7%A5%E4%BD%9C/">
                        <span class="tag">工作</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%8B%9B%E8%81%98/">
                        <span class="tag">招聘</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/">
                        <span class="tag">敏捷开发</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%9C%88%E6%8A%A5/">
                        <span class="tag">月报</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E6%9C%AC%E5%9C%B0%E5%8C%96/">
                        <span class="tag">本地化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%94%9F%E6%B4%BB/">
                        <span class="tag">生活</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/">
                        <span class="tag">程序员</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E7%BF%BB%E8%AF%91/">
                        <span class="tag">翻译</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%93%9D%E7%89%99/">
                        <span class="tag">蓝牙</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="tag">计算机网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%98%85%E8%AF%BB/">
                        <span class="tag">阅读</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/">
                        <span class="tag">静态分析</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/">
                        <span class="tag">面试</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/">
                        <span class="tag">黑苹果</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen is-sticky">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo_2.svg" alt="zhangferry" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 zhangferry&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                共<span id="busuanzi_value_site_uv">0</span>个访客
                </span>
                <span id="busuanzi_container_site_pv">
                共<span id="busuanzi_value_site_pv">0</span>访问量
              </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://zhangferry.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>